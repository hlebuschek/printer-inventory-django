# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å –∑–∞—Å—Ç—Ä—è–≤—à–∏–º–∏ GLPI –∑–∞–¥–∞—á–∞–º–∏ –≤ Celery

## –ü—Ä–æ–±–ª–µ–º–∞

–ó–∞–¥–∞—á–∏ `check_all_devices_in_glpi` –∑–∞—Å—Ç—Ä–µ–≤–∞—é—Ç –≤ –æ—á–µ—Ä–µ–¥–∏ `low_priority` –∏ –Ω–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è, –Ω–µ—Å–º–æ—Ç—Ä—è –Ω–∞ —Ç–æ, —á—Ç–æ:
- Workers –∑–∞–ø—É—â–µ–Ω—ã –∏ —Ä–∞–±–æ—Ç–∞—é—Ç
- –ö–æ–º–∞–Ω–¥–∞ `python manage.py sync_glpi` –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —É—Å–ø–µ—à–Ω–æ
- –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (ETA) –∑–∞–¥–∞—á —É–∂–µ –ø—Ä–æ—à–ª–æ

## –ü—Ä–∏—á–∏–Ω–∞

–í `printer_inventory/celery.py` –∑–∞–¥–∞—á–∞ `check_all_devices_in_glpi` –Ω–µ –±—ã–ª–∞ —è–≤–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∞, –∏–∑-–∑–∞ —á–µ–≥–æ workers –Ω–µ –º–æ–≥–ª–∏ –µ—ë –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å. –ë—ã–ª–∏ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã —Ç–æ–ª—å–∫–æ:

```python
from integrations.tasks import export_monthly_report_to_glpi  # noqa: F401
```

–ù–æ –Ω–µ –±—ã–ª–∏ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã:
- `check_all_devices_in_glpi`
- `check_single_device_in_glpi`

## –†–µ—à–µ–Ω–∏–µ

### 1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞

–î–æ–±–∞–≤–ª–µ–Ω —è–≤–Ω—ã–π –∏–º–ø–æ—Ä—Ç –≤—Å–µ—Ö –∑–∞–¥–∞—á –∏–∑ `integrations.tasks` –≤ `printer_inventory/celery.py`:

```python
from integrations.tasks import (  # noqa: F401
    export_monthly_report_to_glpi,
    check_all_devices_in_glpi,
    check_single_device_in_glpi
)
```

### 2. –û—á–∏—Å—Ç–∫–∞ –∑–∞—Å—Ç—Ä—è–≤—à–∏—Ö –∑–∞–¥–∞—á

–°–æ–∑–¥–∞–Ω–æ –¥–≤–∞ —Å–∫—Ä–∏–ø—Ç–∞ –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –∑–∞—Å—Ç—Ä—è–≤—à–∏—Ö –∑–∞–¥–∞—á:

#### –í–∞—Ä–∏–∞–Ω—Ç 1: Bash —Å–∫—Ä–∏–ø—Ç (–±—ã—Å—Ç—Ä—ã–π)

```bash
./cleanup_glpi_tasks.sh
```

#### –í–∞—Ä–∏–∞–Ω—Ç 2: Python —Å–∫—Ä–∏–ø—Ç (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π)

```bash
# –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä
python cleanup_glpi_tasks.py --dry-run

# –û—á–∏—Å—Ç–∫–∞
python cleanup_glpi_tasks.py
```

### 3. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ workers

–ü–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏ –∑–∞–¥–∞—á –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å workers:

```bash
# –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è systemd
sudo systemctl restart celery-worker*

# –ò–ª–∏ —á–µ—Ä–µ–∑ start_workers.sh
./stop_workers.sh
./start_workers.sh
```

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞

–ü–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–¥–∞—á –≤ –æ—á–µ—Ä–µ–¥–∏
./find_glpi_tasks.sh

# –ü—Ä–æ–≤–µ—Ä–∫–∞ workers
./diagnose_workers.sh

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
tail -f logs/celery.log | grep -i glpi
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —É–¥–æ–±–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –∑–∞–ø—É—Å–∫–∞:

```bash
# –ó–∞–ø—É—Å–∫ —Å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø–æ—Å–ª–µ —Ä–µ–ª–∏–∑–∞)
./run_glpi_check.sh sync

# –ó–∞–ø—É—Å–∫ –≤ —Ñ–æ–Ω–µ
./run_glpi_check.sh async

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
./run_glpi_check.sh status TASK_ID
```

### –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ management –∫–æ–º–∞–Ω–¥—É

```bash
# –°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π —Ä–µ–∂–∏–º —Å –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–æ–º
python manage.py check_glpi --sync

# –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π —Ä–µ–∂–∏–º
python manage.py check_glpi

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–¥–∞—á–∏
python manage.py check_glpi --status TASK_ID
```

### –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ shell

```python
python manage.py shell
```

```python
from integrations.tasks import check_all_devices_in_glpi

# –ó–∞–ø—É—Å–∫ –∑–∞–¥–∞—á–∏ –≤ —Ñ–æ–Ω–µ
result = check_all_devices_in_glpi.delay()
print(f"Task ID: {result.id}")

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
print(f"Status: {result.status}")

# –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ (–∂–¥–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è)
print(result.get(timeout=300))
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è

–ó–∞–¥–∞—á–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 02:00:

```python
# settings.py
CELERY_BEAT_SCHEDULE = {
    'glpi-check-all-devices-daily': {
        'task': 'integrations.tasks.check_all_devices_in_glpi',
        'schedule': crontab(hour=2, minute=0),  # 02:00 –∫–∞–∂–¥—ã–π –¥–µ–Ω—å
        'options': {
            'queue': 'high_priority',  # –í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
            'priority': 5
        }
    },
}
```

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø—Ä–æ–≥—Ä–µ—Å—Å

–ó–∞–¥–∞—á–∞ —Ç–µ–ø–µ—Ä—å –≤—ã–≤–æ–¥–∏—Ç –ø–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏:

- **–ù–∞—á–∞–ª–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**: Banner —Å —ç–º–æ–¥–∑–∏ –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
- **–ü—Ä–æ–≥—Ä–µ—Å—Å –∫–∞–∂–¥—ã–µ 10 —É—Å—Ç—Ä–æ–π—Å—Ç–≤**: –ü—Ä–æ—Ü–µ–Ω—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- **–§–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç**: –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è, –∏—Ç–æ–≥–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞, –¥–µ—Ç–∞–ª–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
- **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è**: –ß–µ—Ä–µ–∑ `self.update_state()` –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —á–µ—Ä–µ–∑ Celery

–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞ –≤ –ª–æ–≥–∞—Ö:

```
======================================================================
üöÄ –ù–ê–ß–ê–õ–û –ü–†–û–í–ï–†–ö–ò –£–°–¢–†–û–ô–°–¢–í –í GLPI
======================================================================
‚úì –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: glpi_sync
üìä –ù–∞–π–¥–µ–Ω–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏: 150
----------------------------------------------------------------------
üìà –ü—Ä–æ–≥—Ä–µ—Å—Å: 10/150 (6%) | –ù–∞–π–¥–µ–Ω–æ: 8, –ö–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤: 0, –ù–µ –Ω–∞–π–¥–µ–Ω–æ: 2, –û—à–∏–±–æ–∫: 0
üìà –ü—Ä–æ–≥—Ä–µ—Å—Å: 20/150 (13%) | –ù–∞–π–¥–µ–Ω–æ: 16, –ö–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤: 1, –ù–µ –Ω–∞–π–¥–µ–Ω–æ: 3, –û—à–∏–±–æ–∫: 0
...
======================================================================
‚úÖ –ü–†–û–í–ï–†–ö–ê –ó–ê–í–ï–†–®–ï–ù–ê
======================================================================
‚è±Ô∏è  –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: 45.3—Å (0.8–º)
üìä –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤: 150/150
‚úì  –ù–∞–π–¥–µ–Ω–æ (1 –∫–∞—Ä—Ç–æ—á–∫–∞): 140
‚ö†Ô∏è  –ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã (>1 –∫–∞—Ä—Ç–æ—á–∫–∏): 3
‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω–æ –≤ GLPI: 5
‚ùó –û—à–∏–±–æ–∫ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ: 2
----------------------------------------------------------------------
‚ö†Ô∏è  –û–ë–ù–ê–†–£–ñ–ï–ù–û 3 –ö–û–ù–§–õ–ò–ö–¢–û–í:
  ‚Ä¢ Device #12 (ABC123): 2 –∫–∞—Ä—Ç–æ—á–µ–∫ –≤ GLPI - IDs: [456, 789]
  ‚Ä¢ Device #45 (XYZ789): 3 –∫–∞—Ä—Ç–æ—á–µ–∫ –≤ GLPI - IDs: [111, 222, 333]
======================================================================
```

## –ü—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏–∫–∞

### –†–µ–≥—É–ª—è—Ä–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–î–æ–±–∞–≤—å—Ç–µ –≤ cron –ø—Ä–æ–≤–µ—Ä–∫—É –∑–∞—Å—Ç—Ä—è–≤—à–∏—Ö –∑–∞–¥–∞—á:

```bash
# –ö–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤
0 */6 * * * cd /path/to/project && ./find_glpi_tasks.sh >> logs/glpi_tasks_monitor.log 2>&1
```

### –ê–ª–µ—Ä—Ç—ã

–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∞–ª–µ—Ä—Ç—ã –≤ –≤–∞—à–µ–π —Å–∏—Å—Ç–µ–º–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–¥–∞—á –≤ –æ—á–µ—Ä–µ–¥–∏ > 15000
- –ó–∞–¥–∞—á–∏ —Å `retries > 2`
- –ó–∞–¥–∞—á–∏ —Å –∏—Å—Ç–µ–∫—à–∏–º ETA

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∑–∞–¥–∞—á–∏

```python
@shared_task(bind=True, max_retries=3)
def check_all_devices_in_glpi(self):
    """
    –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –∑–∞–¥–∞—á–∞: –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –≤—Å–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –≤ GLPI.

    - –ü–æ–ª—É—á–∞–µ—Ç –≤—Å–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ —Å —Å–µ—Ä–∏–π–Ω—ã–º–∏ –Ω–æ–º–µ—Ä–∞–º–∏
    - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–∞–∂–¥–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ —á–µ—Ä–µ–∑ GLPI API
    - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ –º–æ–¥–µ–ª—å GLPISync
    - –í —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏ –¥–µ–ª–∞–µ—Ç retry —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π
    """
```

### Retry –ø–æ–ª–∏—Ç–∏–∫–∞

- **max_retries**: 3
- **–ó–∞–¥–µ—Ä–∂–∫–∞**: —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è
  - 1-—è –ø–æ–ø—ã—Ç–∫–∞: —Å—Ä–∞–∑—É
  - 2-—è –ø–æ–ø—ã—Ç–∫–∞: —á–µ—Ä–µ–∑ 5 –º–∏–Ω—É—Ç (300s)
  - 3-—è –ø–æ–ø—ã—Ç–∫–∞: —á–µ—Ä–µ–∑ 20 –º–∏–Ω—É—Ç (1200s)
  - 4-—è –ø–æ–ø—ã—Ç–∫–∞: —á–µ—Ä–µ–∑ 80 –º–∏–Ω—É—Ç (4800s)

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–ó–∞–¥–∞—á–∞ –ª–æ–≥–∏—Ä—É–µ—Ç:
- –ù–∞—á–∞–ª–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: `"Starting daily GLPI check for all devices"`
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤: `"Found {N} devices to check"`
- –ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã: `"Found {N} devices with conflicts"`
- –û—à–∏–±–∫–∏: `"Fatal error in GLPI check task: {exc}"`

–õ–æ–≥–∏ –º–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤:
- Django logs: `tail -f logs/django.log`
- Celery logs: `tail -f logs/celery.log`

## –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### –ö–æ–¥ –∑–∞–¥–∞—á
- `printer_inventory/celery.py` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Celery, —è–≤–Ω—ã–π –∏–º–ø–æ—Ä—Ç –∑–∞–¥–∞—á
- `integrations/tasks.py` - –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á —Å —É–ª—É—á—à–µ–Ω–Ω—ã–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- `integrations/glpi/services.py` - –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ GLPI
- `integrations/glpi/client.py` - GLPI API –∫–ª–∏–µ–Ω—Ç
- `integrations/models.py` - –º–æ–¥–µ–ª—å GLPISync

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏
- `printer_inventory/settings.py` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –∏ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏:
  - `CELERY_BEAT_SCHEDULE` - —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á
  - `CELERY_TASK_ROUTES` - –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –ø–æ –æ—á–µ—Ä–µ–¥—è–º (high_priority)

### –£—Ç–∏–ª–∏—Ç—ã
- `integrations/management/commands/check_glpi.py` - management –∫–æ–º–∞–Ω–¥–∞ —Å –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–æ–º
- `run_glpi_check.sh` - –±—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫ –ø—Ä–æ–≤–µ—Ä–∫–∏
- `cleanup_glpi_tasks.py` - –æ—á–∏—Å—Ç–∫–∞ –∑–∞—Å—Ç—Ä—è–≤—à–∏—Ö –∑–∞–¥–∞—á
- `cleanup_glpi_tasks.sh` - –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –æ—á–∏—Å—Ç–∫–∏

## –ò–∑–º–µ–Ω–µ–Ω–∏—è (Changelog)

### v2.0 - –£–ª—É—á—à–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã

**–ò–∑–º–µ–Ω–µ–Ω–æ:**
- ‚úÖ –ó–∞–¥–∞—á–∏ GLPI —Ç–µ–ø–µ—Ä—å –∏–¥—É—Ç –≤ –æ—á–µ—Ä–µ–¥—å `high_priority` –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —ç–º–æ–¥–∑–∏ –∏ –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–æ–º
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–∂–¥—ã–µ 10 —É—Å—Ç—Ä–æ–π—Å—Ç–≤
- ‚úÖ –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ —á–µ—Ä–µ–∑ `self.update_state()`
- ‚úÖ –§–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç —Å –≤—Ä–µ–º–µ–Ω–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∏ –¥–µ—Ç–∞–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π

**–î–æ–±–∞–≤–ª–µ–Ω–æ:**
- ‚ûï Management –∫–æ–º–∞–Ω–¥–∞ `python manage.py check_glpi` —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π:
  - `--sync` - —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π —Ä–µ–∂–∏–º —Å –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–æ–º
  - `--status TASK_ID` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–¥–∞—á–∏
- ‚ûï –°–∫—Ä–∏–ø—Ç `run_glpi_check.sh` –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –∑–∞–ø—É—Å–∫–∞
- ‚ûï –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –∏ –æ—à–∏–±–æ–∫

**–§–∞–π–ª—ã:**
- `printer_inventory/settings.py`: –∏–∑–º–µ–Ω–µ–Ω–∞ –æ—á–µ—Ä–µ–¥—å –Ω–∞ `high_priority`
- `integrations/tasks.py`: —É–ª—É—á—à–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- `integrations/management/commands/check_glpi.py`: –Ω–æ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞
- `run_glpi_check.sh`: –Ω–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç

### v1.0 - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∑–∞–¥–∞—á

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ó–∞–¥–∞—á–∏ –∑–∞—Å—Ç—Ä–µ–≤–∞–ª–∏ –≤ –æ—á–µ—Ä–µ–¥–∏ –∏–∑-–∑–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è —è–≤–Ω–æ–≥–æ –∏–º–ø–æ—Ä—Ç–∞

**–†–µ—à–µ–Ω–∏–µ:**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —è–≤–Ω—ã–π –∏–º–ø–æ—Ä—Ç –≤—Å–µ—Ö –∑–∞–¥–∞—á –≤ `printer_inventory/celery.py`
- ‚ûï –°–æ–∑–¥–∞–Ω—ã —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –∑–∞—Å—Ç—Ä—è–≤—à–∏—Ö –∑–∞–¥–∞—á

**–§–∞–π–ª—ã:**
- `printer_inventory/celery.py`: –¥–æ–±–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç
- `cleanup_glpi_tasks.py`: –Ω–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç
- `cleanup_glpi_tasks.sh`: –Ω–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç

## –ö–æ–Ω—Ç–∞–∫—Ç—ã

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ workers: `journalctl -u celery-worker* -n 100`
2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–æ–≤–µ—Ä–∫—É –≤—Ä—É—á–Ω—É—é: `./run_glpi_check.sh sync`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ GLPI: `python manage.py sync_glpi --limit 1 --force`
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Redis: `redis-cli -n 3 INFO`
5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Celery: `tail -f logs/celery.log | grep -i glpi`
