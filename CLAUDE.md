# CLAUDE.md - –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –¥–ª—è AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–≤ –ø–æ Printer Inventory Django

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-11-21
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ö–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –¥–ª—è AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–≤, —Ä–∞–±–æ—Ç–∞—é—â–∏—Ö —Å —ç—Ç–æ–π —Å–∏—Å—Ç–µ–º–æ–π —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏–µ–π –ø—Ä–∏–Ω—Ç–µ—Ä–æ–≤ –Ω–∞ Django

---

## –ö—Ä–∞—Ç–∫–∏–π –æ–±–∑–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞

**–ß—Ç–æ —ç—Ç–æ?** –í–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ Django –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–µ—Ç–µ–≤—ã–º–∏ –ø—Ä–∏–Ω—Ç–µ—Ä–∞–º–∏ —Å –æ–ø—Ä–æ—Å–æ–º –ø–æ SNMP, –≤–µ–±-–ø–∞—Ä—Å–∏–Ω–≥–æ–º, –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞–º–∏ –∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ–º –æ—Ç—á–µ—Ç–æ–≤ –æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏.

**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫:** Django 5.2 + PostgreSQL + Redis + Celery + Django Channels + Keycloak/OIDC + Alpine.js + Bootstrap 5

**–†–∞–∑–º–µ—Ä:** ~8,000 —Å—Ç—Ä–æ–∫ Python-–∫–æ–¥–∞ –≤ 4 Django-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö

---

## –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã–µ —Ñ–∞–π–ª—ã –∏ –∏—Ö —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- `printer_inventory/settings.py` (23KB) - –í—Å—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Django, middleware, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- `.env` - –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (DATABASE, REDIS, KEYCLOAK —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)
- `docker-compose.yml` - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Keycloak –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### –û—Å–Ω–æ–≤–Ω–∞—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
- `inventory/services.py` (611 —Å—Ç—Ä–æ–∫) - **–û–°–ù–û–í–ù–û–ô –î–í–ò–ñ–û–ö –û–ü–†–û–°–ê** - –ü—Ä–æ—á–∏—Ç–∞–π—Ç–µ —ç—Ç–æ –≤ –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å!
- `inventory/web_parser.py` (18KB) - –î–≤–∏–∂–æ–∫ –≤–µ–±-—Å–∫—Ä–µ–π–ø–∏–Ω–≥–∞ (XPath + Regex)
- `monthly_report/services_inventory_sync.py` (16KB) - –õ–æ–≥–∏–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
- `printer_inventory/auth_backends.py` (13KB) - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Keycloak/OIDC

### –ú–æ–¥–µ–ª–∏ (—Å—Ö–µ–º–∞ –¥–∞–Ω–Ω—ã—Ö)
- `inventory/models.py` (377 —Å—Ç—Ä–æ–∫) - Printer, InventoryTask, PageCounter, WebParsingRule
- `contracts/models.py` (10KB) - DeviceModel, ContractDevice, Cartridge
- `monthly_report/models.py` (311 —Å—Ç—Ä–æ–∫) - MonthlyReport
- `access/models.py` - AllowedUser (–±–µ–ª—ã–π —Å–ø–∏—Å–æ–∫)

### –ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è (–º–æ–¥—É–ª—å–Ω—ã–µ)
- `inventory/views/printer_views.py` - CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è –ø—Ä–∏–Ω—Ç–µ—Ä–æ–≤
- `inventory/views/api_views.py` - REST API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã (17KB)
- `inventory/views/web_parser_views.py` - UI –≤–µ–±-–ø–∞—Ä—Å–∏–Ω–≥–∞ (23KB)
- `inventory/views/export_views.py` - –≠–∫—Å–ø–æ—Ä—Ç –≤ Excel (14KB)
- `contracts/views.py` (33KB) - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞–º–∏
- `monthly_report/views.py` (49KB) - –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –æ—Ç—á–µ—Ç–æ–≤

### –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ –∏ WebSocket
- `inventory/tasks.py` - –ó–∞–¥–∞—á–∏ Celery –¥–ª—è –æ–ø—Ä–æ—Å–∞
- `inventory/consumers.py` - WebSocket –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å –¥–ª—è –æ–ø—Ä–æ—Å–∞ –ø—Ä–∏–Ω—Ç–µ—Ä–æ–≤
- `inventory/routing.py` - WebSocket URL routing –¥–ª—è inventory
- `monthly_report/consumers.py` - WebSocket –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å –¥–ª—è real-time —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- `monthly_report/routing.py` - WebSocket URL routing –¥–ª—è monthly_report
- `printer_inventory/celery.py` - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è Celery
- `printer_inventory/asgi.py` - ASGI –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å WebSocket –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π

### –®–∞–±–ª–æ–Ω—ã –∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥
- `templates/base.html` - –ì–ª–∞–≤–Ω—ã–π –º–∞–∫–µ—Ç —Å Alpine.js
- `static/js/vendor/alpine.min.js` - –†–µ–∞–∫—Ç–∏–≤–Ω—ã–π —Ñ—Ä–µ–π–º–≤–æ—Ä–∫
- `static/css/vendor/bootstrap.min.css` - CSS —Ñ—Ä–µ–π–º–≤–æ—Ä–∫

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã

### 1. Django –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–º–æ–¥—É–ª—å–Ω—ã–π –¥–∏–∑–∞–π–Ω)
–ö–∞–∂–¥–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å–∞–º–æ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å –º–æ–¥–µ–ª—è–º–∏, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è–º–∏, —Ñ–æ—Ä–º–∞–º–∏, —à–∞–±–ª–æ–Ω–∞–º–∏, –∞–¥–º–∏–Ω–∫–æ–π, URL:
- **inventory** - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–Ω—Ç–µ—Ä–∞–º–∏ –∏ –æ–ø—Ä–æ—Å
- **contracts** - –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤ —É—Å—Ç—Ä–æ–π—Å—Ç–≤
- **access** - –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
- **monthly_report** - –û—Ç—á–µ—Ç—ã –æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏

### 2. –ü–∞—Ç—Ç–µ—Ä–Ω —Å–ª–æ—è —Å–µ—Ä–≤–∏—Å–æ–≤
**–¢—è–∂–µ–ª–∞—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Ñ–∞–π–ª–∞—Ö `services.py`, –ù–ï –≤ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è—Ö.**
- –ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç HTTP –∑–∞–ø—Ä–æ—Å—ã/–æ—Ç–≤–µ—Ç—ã
- –°–µ—Ä–≤–∏—Å—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É
- –ü—Ä–∏–º–µ—Ä: `run_inventory_for_printer()` –≤ `inventory/services.py`

### 3. –û—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á (Celery)
–î–ª–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –∑–∞–¥–∞—á–∏ Celery:
- **3 –æ—á–µ—Ä–µ–¥–∏ –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É:** high_priority, default, low_priority
- –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ —á–µ—Ä–µ–∑ Celery Beat
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –æ—Ç–∑—ã–≤—á–∏–≤–æ—Å—Ç—å UI

### 4. –°—Ç—Ä–∞—Ç–µ–≥–∏—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è (Redis)
**3 –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö Redis:**
- DB 0: –û–±—â–∏–π –∫—ç—à (TTL 15 –º–∏–Ω)
- DB 1: –°–µ—Å—Å–∏–∏ (TTL 7 –¥–Ω–µ–π)
- DB 2: –î–∞–Ω–Ω—ã–µ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è (TTL 30 –º–∏–Ω)

### 5. –û–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ (WebSockets)
- Django Channels + Redis pub/sub
- WebSocket —ç–Ω–¥–ø–æ–∏–Ω—Ç: `/ws/inventory/`
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –æ–ø—Ä–æ—Å–æ–≤

### 6. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –æ—à–∏–±–æ–∫ (400, 403, 404, 405, 500)
- –ì–æ—Ç–æ–≤–æ–µ –∫ production –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `logs/django.log` –∏ `logs/errors.log`
- Middleware –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ –∑–∞—â–∏—Ç–∞ CSRF

### 7. –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (–∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–π OIDC)
- Keycloak –∫–∞–∫ –ø—Ä–æ–≤–∞–π–¥–µ—Ä –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- –ú–æ–¥–µ–ª—å –±–µ–ª–æ–≥–æ —Å–ø–∏—Å–∫–∞ AllowedUser
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π OIDC –±—ç–∫–µ–Ω–¥ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º —Ç–æ–∫–µ–Ω–æ–≤
- –†–∞–∑—Ä–µ—à–µ–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –≥—Ä—É–ø–ø

### 8. –ö–∞—Å—Ç–æ–º–Ω—ã–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
**Inventory:**
- `access_inventory_app` - –î–æ—Å—Ç—É–ø –∫ –º–æ–¥—É–ª—é –∏–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏–∏
- `run_inventory` - –ó–∞–ø—É—Å–∫ –æ–ø—Ä–æ—Å–∞ –æ–¥–Ω–æ–≥–æ –ø—Ä–∏–Ω—Ç–µ—Ä–∞
- `export_printers` - –≠–∫—Å–ø–æ—Ä—Ç —Å–ø–∏—Å–∫–∞ –ø—Ä–∏–Ω—Ç–µ—Ä–æ–≤ –≤ Excel
- `export_amb_report` - –≠–∫—Å–ø–æ—Ä—Ç –æ—Ç—á–µ—Ç–∞ –¥–ª—è –ê–ú–ë
- `manage_web_parsing` - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª–∞–º–∏ –≤–µ–±-–ø–∞—Ä—Å–∏–Ω–≥–∞
- `view_web_parsing` - –ü—Ä–æ—Å–º–æ—Ç—Ä –ø—Ä–∞–≤–∏–ª –≤–µ–±-–ø–∞—Ä—Å–∏–Ω–≥–∞

**Contracts:**
- `access_contracts_app` - –î–æ—Å—Ç—É–ø –∫ –º–æ–¥—É–ª—é –¥–æ–≥–æ–≤–æ—Ä–æ–≤
- `export_contracts` - –≠–∫—Å–ø–æ—Ä—Ç –¥–æ–≥–æ–≤–æ—Ä–æ–≤ –≤ Excel

**Monthly Report:**
- `access_monthly_report` - –î–æ—Å—Ç—É–ø –∫ –º–æ–¥—É–ª—é –µ–∂–µ–º–µ—Å—è—á–Ω—ã—Ö –æ—Ç—á–µ—Ç–æ–≤
- `upload_monthly_report` - –ó–∞–≥—Ä—É–∑–∫–∞ –æ—Ç—á–µ—Ç–æ–≤ –∏–∑ Excel
- `edit_counters_start` - –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–æ–≤ –Ω–∞ –Ω–∞—á–∞–ª–æ –ø–µ—Ä–∏–æ–¥–∞
- `edit_counters_end` - –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–æ–≤ –Ω–∞ –∫–æ–Ω–µ—Ü –ø–µ—Ä–∏–æ–¥–∞
- `sync_from_inventory` - –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ Inventory
- `view_change_history` - –ü—Ä–æ—Å–º–æ—Ç—Ä –∏—Å—Ç–æ—Ä–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- `can_manage_month_visibility` - **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∏–¥–∏–º–æ—Å—Ç—å—é –º–µ—Å—è—Ü–µ–≤** (–ø—É–±–ª–∏–∫–∞—Ü–∏—è/—Å–∫—Ä—ã—Ç–∏–µ –æ—Ç—á–µ—Ç–æ–≤)
- `can_reset_auto_polling` - **–í–æ–∑–≤—Ä–∞—Ç –ø—Ä–∏–Ω—Ç–µ—Ä–∞ –Ω–∞ –∞–≤—Ç–æ–æ–ø—Ä–æ—Å** (—Å–±—Ä–æ—Å —Ñ–ª–∞–≥–æ–≤ —Ä—É—á–Ω–æ–≥–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
- `can_poll_all_printers` - **–û–ø—Ä–æ—Å –≤—Å–µ—Ö –ø—Ä–∏–Ω—Ç–µ—Ä–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ** (–º–∞—Å—Å–æ–≤—ã–π –æ–ø—Ä–æ—Å)

**–ì—Ä—É–ø–ø—ã –ø—Ä–∞–≤ (—Å–æ–∑–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ `python manage.py init_monthly_report_roles`):**
- –ï–∂–µ–º–µ—Å—è—á–Ω—ã–µ –æ—Ç—á—ë—Ç—ã ‚Äî –ü—Ä–æ—Å–º–æ—Ç—Ä
- –ï–∂–µ–º–µ—Å—è—á–Ω—ã–µ –æ—Ç—á—ë—Ç—ã ‚Äî –ó–∞–≥—Ä—É–∑–∫–∞
- –ï–∂–µ–º–µ—Å—è—á–Ω—ã–µ –æ—Ç—á—ë—Ç—ã ‚Äî –†–µ–¥–∞–∫—Ç–æ—Ä—ã (–Ω–∞—á–∞–ª–æ)
- –ï–∂–µ–º–µ—Å—è—á–Ω—ã–µ –æ—Ç—á—ë—Ç—ã ‚Äî –†–µ–¥–∞–∫—Ç–æ—Ä—ã (–∫–æ–Ω–µ—Ü)
- –ï–∂–µ–º–µ—Å—è—á–Ω—ã–µ –æ—Ç—á—ë—Ç—ã ‚Äî –†–µ–¥–∞–∫—Ç–æ—Ä—ã (–ø–æ–ª–Ω—ã–µ)
- –ï–∂–µ–º–µ—Å—è—á–Ω—ã–µ –æ—Ç—á—ë—Ç—ã ‚Äî –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
- –ï–∂–µ–º–µ—Å—è—á–Ω—ã–µ –æ—Ç—á—ë—Ç—ã ‚Äî –ú–µ–Ω–µ–¥–∂–µ—Ä—ã (–≤—Å–µ –ø—Ä–∞–≤–∞)
- –ï–∂–µ–º–µ—Å—è—á–Ω—ã–µ –æ—Ç—á—ë—Ç—ã ‚Äî –ò—Å—Ç–æ—Ä–∏—è (–ø—Ä–æ—Å–º–æ—Ç—Ä)
- –ï–∂–µ–º–µ—Å—è—á–Ω—ã–µ –æ—Ç—á—ë—Ç—ã ‚Äî –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∏–¥–∏–º–æ—Å—Ç—å—é (–ø—É–±–ª–∏–∫–∞—Ü–∏—è/—Å–∫—Ä—ã—Ç–∏–µ –º–µ—Å—è—Ü–µ–≤)
- –ï–∂–µ–º–µ—Å—è—á–Ω—ã–µ –æ—Ç—á—ë—Ç—ã ‚Äî –°–±—Ä–æ—Å –∞–≤—Ç–æ–æ–ø—Ä–æ—Å–∞ (–≤–æ–∑–≤—Ä–∞—Ç –Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –æ–ø—Ä–æ—Å)
- –ï–∂–µ–º–µ—Å—è—á–Ω—ã–µ –æ—Ç—á—ë—Ç—ã ‚Äî –û–ø—Ä–æ—Å –≤—Å–µ—Ö –ø—Ä–∏–Ω—Ç–µ—Ä–æ–≤ (–º–∞—Å—Å–æ–≤—ã–π –æ–ø—Ä–æ—Å)

---

## –ò–µ—Ä–∞—Ä—Ö–∏—è –º–æ–¥–µ–ª–µ–π –¥–∞–Ω–Ω—ã—Ö

```
Organization
  ‚îú‚îÄ‚îÄ Printer (IP –∞–¥—Ä–µ—Å, SNMP community, –º–µ—Ç–æ–¥ –æ–ø—Ä–æ—Å–∞)
  ‚îÇ   ‚îú‚îÄ‚îÄ InventoryTask (–∏—Å—Ç–æ—Ä–∏—è –æ–ø—Ä–æ—Å–æ–≤ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º)
  ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ PageCounter (—Å—á–µ—Ç—á–∏–∫–∏ –∏ —Ä–∞—Å—Ö–æ–¥–Ω–∏–∫–∏ –Ω–∞ –∫–∞–∂–¥—ã–π –æ–ø—Ä–æ—Å)
  ‚îÇ   ‚îî‚îÄ‚îÄ WebParsingRule (–ø—Ä–∞–≤–∏–ª–∞ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è XPath/Regex)
  ‚îÇ       ‚îî‚îÄ‚îÄ WebParsingTemplate (–ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏)
  ‚îÇ
  ‚îî‚îÄ‚îÄ ContractDevice (—É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –≤ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞–º–∏)
      ‚îú‚îÄ‚îÄ DeviceModel (–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å, —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏, —Ç–∏–ø, has_network_port)
      ‚îÇ   ‚îú‚îÄ‚îÄ Manufacturer
      ‚îÇ   ‚îú‚îÄ‚îÄ Cartridge (—Ä–∞—Å—Ö–æ–¥–Ω–∏–∫–∏)
      ‚îÇ   ‚îî‚îÄ‚îÄ ContractStatus
      ‚îî‚îÄ‚îÄ OneToOne ‚Üí Printer (—Å–≤—è–∑—å —Å –∏–Ω–≤–µ–Ω—Ç–∞—Ä–µ–º)

MonthlyReport (—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –∏–∑ –¥–∞–Ω–Ω—ã—Ö InventoryTask)
  ‚îú‚îÄ‚îÄ Counters (–Ω–∞—á–∞–ª–æ/–∫–æ–Ω–µ—Ü, —Ñ–ª–∞–≥–∏ —Ä—É—á–Ω–æ–≥–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, —Ä–∞—Å—á–µ—Ç—ã K1/K2)
  ‚îî‚îÄ‚îÄ MonthControl (–Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –º–µ—Å—è—Ü–∞: edit_until, is_published)
```

---

## –û—Å–Ω–æ–≤–Ω—ã–µ —Ä–∞–±–æ—á–∏–µ –ø—Ä–æ—Ü–µ—Å—Å—ã

### –†–∞–±–æ—á–∏–π –ø—Ä–æ—Ü–µ—Å—Å –æ–ø—Ä–æ—Å–∞ (–°–∞–º–æ–µ –≤–∞–∂–Ω–æ–µ!)
```
1. –¢—Ä–∏–≥–≥–µ—Ä
   - –í—Ä—É—á–Ω—É—é: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É "–ó–∞–ø—É—Å—Ç–∏—Ç—å –æ–ø—Ä–æ—Å"
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏: –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ Celery Beat (–∫–∞–∂–¥—ã–µ 60 –º–∏–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)

2. –î–∏—Å–ø–µ—Ç—á–µ—Ä–∏–∑–∞—Ü–∏—è –∑–∞–¥–∞—á–∏
   - –í—Ä—É—á–Ω—É—é ‚Üí run_inventory_task_priority() [–æ—á–µ—Ä–µ–¥—å high_priority]
   - –ü–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é ‚Üí run_inventory_task() [–æ—á–µ—Ä–µ–¥—å low_priority]

3. –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞ (inventory/services.py)
   run_inventory_for_printer(printer_id)
   ‚îú‚îÄ‚îÄ –ï—Å–ª–∏ polling_method == SNMP:
   ‚îÇ   ‚îú‚îÄ‚îÄ –í—ã–∑–æ–≤ GLPI Agent —á–µ—Ä–µ–∑ subprocess
   ‚îÇ   ‚îú‚îÄ‚îÄ –ü–∞—Ä—Å–∏–Ω–≥ XML –æ—Ç–≤–µ—Ç–∞
   ‚îÇ   ‚îî‚îÄ‚îÄ –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–æ–≤, —Ä–∞—Å—Ö–æ–¥–Ω–∏–∫–æ–≤, —Å–µ—Ä–∏–π–Ω–æ–≥–æ –Ω–æ–º–µ—Ä–∞, MAC
   ‚îî‚îÄ‚îÄ –ï—Å–ª–∏ polling_method == WEB:
       ‚îú‚îÄ‚îÄ –ü–æ–ª—É—á–µ–Ω–∏–µ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –ø—Ä–∏–Ω—Ç–µ—Ä–∞
       ‚îú‚îÄ‚îÄ –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª XPath/Regex (WebParsingRule)
       ‚îî‚îÄ‚îÄ –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–æ–≤ –∏–∑ HTML

4. –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö (inventory/utils.py:validate_against_history)
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ (A3, —Ü–≤–µ—Ç)
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —É–º–µ–Ω—å—à–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–æ–≤ (> 10%)
   - üõ°Ô∏è –ó–ê–©–ò–¢–ê –û–¢ –ê–ù–û–ú–ê–õ–¨–ù–´–• –°–ö–ê–ß–ö–û–í (Kyocera bug):
     ‚Ä¢ –ï—Å–ª–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–π –æ–ø—Ä–æ—Å –±—ã–ª –≤ —Ç–µ—á–µ–Ω–∏–µ 24 —á–∞—Å–æ–≤
     ‚Ä¢ –ò —Å—á–µ—Ç—á–∏–∫ –≤—ã—Ä–æ—Å –±–æ–ª—å—à–µ —á–µ–º –Ω–∞ 5,000 —Å—Ç—Ä–∞–Ω–∏—Ü
     ‚Ä¢ ‚Üí –î–∞–Ω–Ω—ã–µ –æ—Ç–∫–ª–æ–Ω—è—é—Ç—Å—è —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º HISTORICAL_INCONSISTENCY
     ‚Ä¢ –ò–°–ö–õ–Æ–ß–ï–ù–ò–ï: –ï—Å–ª–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–π –æ–ø—Ä–æ—Å –±—ã–ª > 30 –¥–Ω–µ–π –Ω–∞–∑–∞–¥ - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è
       (–ø—Ä–∏–Ω—Ç–µ—Ä –º–æ–≥ –º–Ω–æ–≥–æ –ø–µ—á–∞—Ç–∞—Ç—å –ø–æ USB –∏–ª–∏ –ª–æ–∫–∞–ª—å–Ω–æ)
     ‚Ä¢ –ó–∞—â–∏—â–∞–µ—Ç –æ—Ç –≥–ª—é–∫–æ–≤ –ø—Ä–∏–Ω—Ç–µ—Ä–æ–≤ Kyocera

5. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
   - –°–æ–∑–¥–∞–Ω–∏–µ InventoryTask (—Å—Ç–∞—Ç—É—Å: SUCCESS –∏–ª–∏ HISTORICAL_INCONSISTENCY)
   - –°–æ–∑–¥–∞–Ω–∏–µ PageCounter (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞)
   - –°–≤—è–∑—å —Å Printer

6. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–æ–≤
   - –û—Ç–ø—Ä–∞–≤–∫–∞ WebSocket —Å–æ–æ–±—â–µ–Ω–∏—è –≥—Ä—É–ø–ø–µ 'inventory_updates'
   - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã

7. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
   - –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ monthly_report —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç —Å—á–µ—Ç—á–∏–∫–∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
```

### –†–∞–±–æ—á–∏–π –ø—Ä–æ—Ü–µ—Å—Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ—Å–µ—â–∞–µ—Ç /accounts/login/
2. –í—ã–±–æ—Ä Keycloak (OIDC) –∏–ª–∏ Django login
3. –ï—Å–ª–∏ Keycloak:
   - –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤—Ö–æ–¥–∞ Keycloak
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç—Å—è
   - Callback –Ω–∞ /oidc/callback/
   - CustomOIDCAuthenticationBackend.authenticate()
     ‚îî‚îÄ‚îÄ –ü—Ä–æ–≤–µ—Ä–∫–∞ AllowedUser.objects.filter(username=..., is_active=True)
     ‚îî‚îÄ‚îÄ –°–æ–∑–¥–∞–Ω–∏–µ –∏–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ Django User
4. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ—Å—Å–∏–∏ –≤ Redis (—Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è 7 –¥–Ω–µ–π)
5. Middleware –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Ç–æ–∫–µ–Ω –ø–µ—Ä–µ–¥ –∏—Å—Ç–µ—á–µ–Ω–∏–µ–º
6. –ß–ª–µ–Ω—Å—Ç–≤–æ –≤ –≥—Ä—É–ø–ø–µ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è
```

### Cookie –ø–æ–ª–∏—Ç–∏–∫–∞ –¥–ª—è Safari –∏ Firefox

**–ü—Ä–æ–±–ª–µ–º–∞:** Safari –∏ Firefox –±–ª–æ–∫–∏—Ä—É—é—Ç cookies –ø—Ä–∏ OAuth —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞—Ö –º–µ–∂–¥—É —Ä–∞–∑–Ω—ã–º–∏ –¥–æ–º–µ–Ω–∞–º–∏ (cross-site).

**Development —Ä–µ—à–µ–Ω–∏–µ:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `localhost` –¥–ª—è –æ–±–æ–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤:
  - Django: `http://localhost:8000`
  - Keycloak: `http://localhost:8080`
- **–ù–ï –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å** `127.0.0.1` - Safari —Å—á–∏—Ç–∞–µ—Ç —ç—Ç–æ –¥—Ä—É–≥–∏–º –¥–æ–º–µ–Ω–æ–º!
- –ù–∞—Å—Ç—Ä–æ–π–∫–∏: `SESSION_COOKIE_SAMESITE = 'Lax'`, `CSRF_COOKIE_SAMESITE = 'Lax'`

**Production —Ä–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–∏ USE_HTTPS=True –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:
  - `SESSION_COOKIE_SAMESITE = 'None'` - —Ä–∞–∑—Ä–µ—à–∞–µ—Ç cross-site cookies
  - `SESSION_COOKIE_SECURE = True` - —Ç—Ä–µ–±—É–µ—Ç HTTPS
  - `CSRF_COOKIE_SAMESITE = 'None'`
  - `CSRF_COOKIE_SECURE = True`
- –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å —Ä–∞–∑–Ω—ã–º–∏ –¥–æ–º–µ–Ω–∞–º–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `app.company.com` –∏ `auth.company.com`)
- **–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ:** –¢–æ–ª—å–∫–æ HTTPS! SameSite=None –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ HTTP.

**Keycloak –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è Safari:**
- –í Keycloak Admin ‚Üí Client ‚Üí Valid Redirect URIs –¥–æ–±–∞–≤–∏—Ç—å –æ–±–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞:
  - Development: `http://localhost:8000/*`
  - Production: `https://your-domain.com/*`
- Web Origins: —É–∫–∞–∑–∞—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –¥–æ–º–µ–Ω

### –†–∞–±–æ—á–∏–π –ø—Ä–æ—Ü–µ—Å—Å –µ–∂–µ–º–µ—Å—è—á–Ω–æ–π –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç–∏
```
1. –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç Excel —Å –¥–∞–Ω–Ω—ã–º–∏ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è
   - –ú–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç—É—Å –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ (—Å–∫—Ä—ã—Ç—ã–π/–≤–∏–¥–∏–º—ã–π) –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
   - –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –æ—Ç—á–µ—Ç —Å–æ–∑–¥–∞–µ—Ç—Å—è —Å–∫—Ä—ã—Ç—ã–º (is_published=False)
2. –°–æ–∑–¥–∞—é—Ç—Å—è —Å—Ç—Ä–æ–∫–∏ MonthlyReport (—Å–æ —Å—á–µ—Ç—á–∏–∫–∞–º–∏ start_*)
3. –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–æ–º–∞–Ω–¥–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:
   - –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ InventoryTask –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
   - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–æ–≤ end_* (—Å —É—á–µ—Ç–æ–º —Ñ–ª–∞–≥–æ–≤ manual_edit_*)
4. –†–∞—Å—á–µ—Ç –º–µ—Ç—Ä–∏–∫:
   - K1 = –ø—Ä–æ—Ü–µ–Ω—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
   - K2 = —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ SLA
5. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –ø—É–±–ª–∏–∫–∞—Ü–∏—è –æ—Ç—á–µ—Ç–∞:
   - –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ —Å–∫—Ä—ã—Ç–æ–º –æ—Ç—á–µ—Ç–µ
   - –ü–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—É–±–ª–∏–∫—É–µ—Ç –æ—Ç—á–µ—Ç –∫–Ω–æ–ø–∫–æ–π "–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å"
   - –ù–µ–æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã–µ –æ—Ç—á–µ—Ç—ã –≤–∏–¥—è—Ç —Ç–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å –ø—Ä–∞–≤–æ–º can_manage_month_visibility
6. –≠–∫—Å–ø–æ—Ä—Ç –≤ Excel –¥–ª—è –≤—ã—Å—Ç–∞–≤–ª–µ–Ω–∏—è —Å—á–µ—Ç–æ–≤/—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è

Real-time —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ê –∏ –ë –æ—Ç–∫—Ä—ã–≤–∞—é—Ç –æ–¥–∏–Ω –º–µ—Å—è—Ü
   - –û–±–∞ –ø–æ–¥–∫–ª—é—á–∞—é—Ç—Å—è –∫ WebSocket –≥—Ä—É–ø–ø–µ monthly_report_{year}_{month}
2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ë –∏–∑–º–µ–Ω—è–µ—Ç —Å—á–µ—Ç—á–∏–∫
   - –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ë–î
   - WebSocket —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ –≥—Ä—É–ø–ø—É
   - –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —Ñ–ª–∞–≥ manual_edit –¥–ª—è –ø–æ–ª—è
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ê –ø–æ–ª—É—á–∞–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
   - –¢–∞–±–ª–∏—Ü–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è
   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è toast —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
4. Optimistic locking –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã
   - –ï—Å–ª–∏ –æ–±–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É—é—Ç –æ–¥–Ω—É —è—á–µ–π–∫—É, —Å–∏—Å—Ç–µ–º–∞ –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç
   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ —Å –æ–±–æ–∏–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏

–í–æ–∑–≤—Ä–∞—Ç –Ω–∞ –∞–≤—Ç–æ–æ–ø—Ä–æ—Å:
1. –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–ª—É—á–∞–π–Ω–æ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–ª —Å—á–µ—Ç—á–∏–∫ –≤—Ä—É—á–Ω—É—é
2. –í –∏—Å—Ç–æ—Ä–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π –µ—Å—Ç—å –∫–Ω–æ–ø–∫–∞ "–í–µ—Ä–Ω—É—Ç—å –Ω–∞ –∞–≤—Ç–æ–æ–ø—Ä–æ—Å"
3. –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ —Å–±—Ä–∞—Å—ã–≤–∞—é—Ç—Å—è –≤—Å–µ —Ñ–ª–∞–≥–∏ manual_edit –¥–ª—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
4. –°—á–µ—Ç—á–∏–∫–∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –∑–Ω–∞—á–µ–Ω–∏—è–º –∏–∑ inventory
5. –¢—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–∞–≤–æ can_reset_auto_polling
```

---

## –†–∞–±–æ—á–∏–µ –ø—Ä–æ—Ü–µ—Å—Å—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
```bash
1. –°–æ–∑–¥–∞–Ω–∏–µ/–∏–∑–º–µ–Ω–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ –≤ apps/<app>/models.py
2. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏: python manage.py makemigrations
3. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏: python manage.py migrate
4. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –≤ apps/<app>/views/ (–∏–ª–∏ views.py)
5. –°–æ–∑–¥–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞ –≤ templates/<app>/
6. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è URL –≤ apps/<app>/urls.py
7. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –∞–¥–º–∏–Ω–∫–∏ –≤ apps/<app>/admin.py (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
8. –ù–∞–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤ –≤ apps/<app>/tests.py
9. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —ç—Ç–æ–≥–æ CLAUDE.md –ø—Ä–∏ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö
```

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ API —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞
```bash
1. –°–æ–∑–¥–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤ inventory/views/api_views.py
2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–∞ @require_http_methods(['GET', 'POST'])
3. –í–æ–∑–≤—Ä–∞—Ç JsonResponse() –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–∞ @json_response
4. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ inventory/urls.py
5. –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —Ä–∞–∑–¥–µ–ª–µ API –Ω–∏–∂–µ
```

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏ Celery
```bash
1. –°–æ–∑–¥–∞–Ω–∏–µ @shared_task –≤ apps/<app>/tasks.py
2. –ò–º–ø–æ—Ä—Ç –≤ printer_inventory/celery.py –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
3. –î–ª—è –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏—Ö: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ CELERY_BEAT_SCHEDULE –≤ settings.py
4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: python manage.py shell
   >>> from inventory.tasks import my_task
   >>> my_task.delay(args)
5. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥: –ü—Ä–æ–≤–µ—Ä–∫–∞ logs/celery.log
```

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–∫–∏
```bash
1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤:
   - logs/django.log (–æ–±—â–∏–µ –æ—à–∏–±–∫–∏)
   - logs/errors.log (production –æ—à–∏–±–∫–∏)
   - logs/celery.log (–æ—à–∏–±–∫–∏ –∑–∞–¥–∞—á)
   - logs/keycloak_auth.log (–ø—Ä–æ–±–ª–µ–º—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏)

2. –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ:
   - python manage.py runserver
   - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ print() –∏–ª–∏ logger.debug() –≤—ã—Ä–∞–∂–µ–Ω–∏–π

3. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–µ—Ä–≤–æ–ø—Ä–∏—á–∏–Ω—ã:
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–¥–µ–π—Å—Ç–≤–æ–≤–∞–Ω–Ω–æ–≥–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è/—Å–µ—Ä–≤–∏—Å–∞
   - –ü—Ä–æ—Å–º–æ—Ç—Ä –ø–æ—Å–ª–µ–¥–Ω–∏—Ö git –∫–æ–º–º–∏—Ç–æ–≤: git log --oneline

4. –ù–∞–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Å–ª—É—á–∞—è –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è —Ä–µ–≥—Ä–µ—Å—Å–∏–∏

5. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏ –∫–æ–º–º–∏—Ç —Å –ø–æ–Ω—è—Ç–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º
```

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
```bash
# –í—Å–µ —Ç–µ—Å—Ç—ã
python manage.py test

# –ö–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
python manage.py test inventory

# –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–µ—Å—Ç–æ–≤—ã–π –∫–ª–∞—Å—Å
python manage.py test inventory.tests.TestPrinterModel

# –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ë–î –º–µ–∂–¥—É –∑–∞–ø—É—Å–∫–∞–º–∏ (–±—ã—Å—Ç—Ä–µ–µ)
python manage.py test --keepdb

# –ü–æ–¥—Ä–æ–±–Ω—ã–π –≤—ã–≤–æ–¥
python manage.py test --verbosity=2
```

---

## –û–±—â–∏–µ –∫–æ–º–∞–Ω–¥—ã

### –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞
```bash
# –í–µ–±-—Å–µ—Ä–≤–µ—Ä (WSGI - –ø—Ä–æ—Å—Ç–æ–π, –±–µ–∑ WebSockets)
python manage.py runserver 0.0.0.0:8000

# ASGI —Å–µ—Ä–≤–µ—Ä (WebSockets –≤–∫–ª—é—á–µ–Ω—ã)
python -m daphne -b 0.0.0.0 -p 5000 printer_inventory.asgi:application

# Celery worker (–æ—Ç–¥–µ–ª—å–Ω—ã–π —Ç–µ—Ä–º–∏–Ω–∞–ª)
celery -A printer_inventory worker --loglevel=info

# Celery beat –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ (–æ—Ç–¥–µ–ª—å–Ω—ã–π —Ç–µ—Ä–º–∏–Ω–∞–ª)
celery -A printer_inventory beat --loglevel=info

# –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞ (production)
./start_workers.sh  # –ó–∞–ø—É—Å–∫–∞–µ—Ç 3 worker + beat
```

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –º–æ–¥–µ–ª–µ–π
python manage.py makemigrations

# –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π
python manage.py migrate

# –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è-–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
python manage.py createsuperuser

# –ö–æ–Ω—Å–æ–ª—å –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
python manage.py dbshell

# –ö–æ–Ω—Å–æ–ª—å Django
python manage.py shell
```

### –£—Ç–∏–ª–∏—Ç—ã
```bash
# –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞ DEBUG
python manage.py toggle_debug --status
python manage.py toggle_debug --on
python manage.py toggle_debug --off

# –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –∑–∞–¥–∞—á –æ–ø—Ä–æ—Å–∞
python manage.py cleanup_old_tasks

# –ò–º–ø–æ—Ä—Ç —É—Å—Ç–∞—Ä–µ–≤—à–µ–π –ë–î Flask
python manage.py import_flask_db path/to/db.sqlite

# –ò–º–ø–æ—Ä—Ç –ø—Ä–∏–Ω—Ç–µ—Ä–æ–≤ –∏–∑ Excel/CSV (–Ω–æ–≤–æ–µ!)
python manage.py import_printers_xlsx printers.xlsx --dry-run --show-details
python manage.py import_printers_xlsx printers.xlsx --auto-create-org --skip-collisions

# –ú–∏–≥—Ä–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –º–æ–¥–µ–ª–µ–π –≤ DeviceModel (–ø–æ—Å–ª–µ –æ–ø—Ä–æ—Å–∞)
python manage.py migrate_models_to_devicemodel --dry-run
python manage.py migrate_models_to_devicemodel

# –°–≤—è–∑—ã–≤–∞–Ω–∏–µ ContractDevice ‚Üî Printer –ø–æ —Å–µ—Ä–∏–π–Ω–∏–∫–∞–º
python manage.py link_devices_by_serial --dry-run
python manage.py link_devices_by_serial

# –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–µ–ª—ã–º —Å–ø–∏—Å–∫–æ–º
python manage.py manage_whitelist --add username
python manage.py manage_whitelist --list

# –°–æ–∑–¥–∞–Ω–∏–µ –≥—Ä—É–ø–ø –ø—Ä–∞–≤ –¥–ª—è monthly_report
python manage.py init_monthly_report_roles

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∑–∞–¥–∞—á Celery
python manage.py celery_monitor

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü –æ—à–∏–±–æ–∫
python manage.py test_errors --test-all

# –°–±–æ—Ä —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤ (production)
python manage.py collectstatic --noinput
```

---

## –ö–ª—é—á–µ–≤—ã–µ —Å–æ–≥–ª–∞—à–µ–Ω–∏—è –∏ –ª—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

### –°—Ç–∏–ª—å –∫–æ–¥–∞
- **Python:** PEP 8 (–æ—Ç—Å—Ç—É–ø—ã 4 –ø—Ä–æ–±–µ–ª–∞)
- **Django:** –°–ª–µ–¥–æ–≤–∞–Ω–∏–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤—É –ø–æ —Å—Ç–∏–ª—é Django
- **–î–ª–∏–Ω–∞ —Å—Ç—Ä–æ–∫–∏:** –º–∞–∫—Å–∏–º—É–º 120 —Å–∏–º–≤–æ–ª–æ–≤ (–Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ –≤ settings)
- **–ò–º–ø–æ—Ä—Ç—ã:** –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –ø–æ—Ä—è–¥–∫—É: stdlib, —Å—Ç–æ—Ä–æ–Ω–Ω–∏–µ, Django, –ª–æ–∫–∞–ª—å–Ω—ã–µ
- **–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏:** –û–±—ä—è—Å–Ω—è–π—Ç–µ –ü–û–ß–ï–ú–£, –∞ –Ω–µ –ß–¢–û (–∫–æ–¥ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å–∞–º–æ–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–º)

### –°–æ–≥–ª–∞—à–µ–Ω–∏—è Django
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `select_related()` –∏ `prefetch_related()` –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è N+1 –∑–∞–ø—Ä–æ—Å–æ–≤
- –í—Å–µ–≥–¥–∞ –¥–æ–±–∞–≤–ª—è–π—Ç–µ –º–µ—Ç–æ–¥—ã `__str__()` –∫ –º–æ–¥–µ–ª—è–º
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `get_absolute_url()` –¥–ª—è URL –º–æ–¥–µ–ª–µ–π
- –ü—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–ª–∞—Å—Å–æ–≤ –¥–ª—è CRUD, —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π –¥–ª—è API
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ñ–æ—Ä–º Django –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- –í—Å–µ–≥–¥–∞ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π—Ç–µ `verbose_name` –∏ `verbose_name_plural` –≤ Meta –º–æ–¥–µ–ª–∏

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
```python
import logging
logger = logging.getLogger(__name__)

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö —É—Ä–æ–≤–Ω–µ–π
logger.debug("–ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è")
logger.info("–û–±—â–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è")
logger.warning("–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞—é—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è")
logger.error("–°–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö")
logger.exception("–ò—Å–∫–ª—é—á–µ–Ω–∏–µ —Å traceback")  # –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –±–ª–æ–∫–∞—Ö except
```

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
```python
# –í —Å–µ—Ä–≤–∏—Å–∞—Ö
try:
    result = risky_operation()
except SpecificException as e:
    logger.error(f"–ù–µ —É–¥–∞–ª–æ—Å—å –≤—ã–ø–æ–ª–Ω–∏—Ç—å X: {e}")
    return None, str(e)  # –í–æ–∑–≤—Ä–∞—Ç –∫–æ—Ä—Ç–µ–∂–∞ (—Ä–µ–∑—É–ª—å—Ç–∞—Ç, –æ—à–∏–±–∫–∞)

# –í –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è—Ö
try:
    data = service_function()
except Exception as e:
    messages.error(request, f"–û–ø–µ—Ä–∞—Ü–∏—è –Ω–µ —É–¥–∞–ª–∞—Å—å: {e}")
    return redirect('some_view')
```

### –ó–∞–¥–∞—á–∏ Celery
```python
from celery import shared_task

@shared_task(bind=True, max_retries=3)
def my_task(self, arg):
    try:
        # –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã
        pass
    except Exception as exc:
        raise self.retry(exc=exc, countdown=60)  # –ü–æ–≤—Ç–æ—Ä —á–µ—Ä–µ–∑ 60—Å
```

### WebSocket —Å–æ–æ–±—â–µ–Ω–∏—è
```python
# –û—Ç–ø—Ä–∞–≤–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≥—Ä—É–ø–ø–µ
from channels.layers import get_channel_layer
from asgiref.sync import async_to_sync

channel_layer = get_channel_layer()
async_to_sync(channel_layer.group_send)(
    "inventory_updates",
    {
        "type": "inventory_update",
        "message": "–û–ø—Ä–æ—Å –∑–∞–≤–µ—Ä—à–µ–Ω",
        "printer_id": printer.id,
    }
)
```

---

## API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã (–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ inventory)

### GET /inventory/api/printers/
–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç JSON —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø—Ä–∏–Ω—Ç–µ—Ä–æ–≤

### GET /inventory/api/printer/<id>/
–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç JSON –¥–µ—Ç–∞–ª–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø—Ä–∏–Ω—Ç–µ—Ä–∞

### POST /inventory/api/run-poll/
–ó–∞–ø—É—Å–∫ –æ–ø—Ä–æ—Å–∞ –¥–ª—è –ø—Ä–∏–Ω—Ç–µ—Ä–∞(–æ–≤)
- –¢–µ–ª–æ: `{"printer_ids": [1, 2, 3]}`
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: ID –∑–∞–¥–∞—á

### GET /inventory/api/task-status/<task_id>/
–ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–¥–∞—á–∏ Celery

### GET /inventory/api/latest-task/<printer_id>/
–ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ InventoryTask –¥–ª—è –ø—Ä–∏–Ω—Ç–µ—Ä–∞

### POST /inventory/api/web-parser/test/
–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∞–≤–∏–ª –≤–µ–±-–ø–∞—Ä—Å–∏–Ω–≥–∞
- –¢–µ–ª–æ: `{"url": "...", "rules": [...]}`

### GET /inventory/export/excel/
–≠–∫—Å–ø–æ—Ä—Ç –ø—Ä–∏–Ω—Ç–µ—Ä–æ–≤ –≤ Excel

### GET /inventory/export/amb/<org_id>/
–≠–∫—Å–ø–æ—Ä—Ç –≤ —Ñ–æ—Ä–º–∞—Ç AMB –¥–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏

---

## URL –ø–∞—Ç—Ç–µ—Ä–Ω—ã (–≤—Å–µ–≥–æ 62)

### –û—Å–Ω–æ–≤–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã
- `/` - –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ (–ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞ inventory)
- `/admin/` - –ê–¥–º–∏–Ω–∫–∞ Django (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ, –ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª–µ–Ω OIDC)
- `/accounts/login/` - –°—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—Ö–æ–¥–∞
- `/accounts/logout/` - –í—ã—Ö–æ–¥
- `/oidc/` - OIDC —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

### –ú–∞—Ä—à—Ä—É—Ç—ã –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
- `/inventory/` - –°–ø–∏—Å–æ–∫ –ø—Ä–∏–Ω—Ç–µ—Ä–æ–≤
- `/inventory/printer/<id>/` - –î–µ—Ç–∞–ª–∏ –ø—Ä–∏–Ω—Ç–µ—Ä–∞
- `/inventory/printer/add/` - –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–Ω—Ç–µ—Ä
- `/inventory/printer/<id>/edit/` - –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–Ω—Ç–µ—Ä
- `/inventory/printer/<id>/delete/` - –£–¥–∞–ª–∏—Ç—å –ø—Ä–∏–Ω—Ç–µ—Ä
- `/inventory/run-poll/` - –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –º–∞—Å—Å–æ–≤–æ–≥–æ –æ–ø—Ä–æ—Å–∞
- `/inventory/web-parser/` - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–µ–±-–ø–∞—Ä—Å–∏–Ω–≥–æ–º
- `/inventory/api/...` - API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã (—Å–º. –≤—ã—à–µ)

### –ú–∞—Ä—à—Ä—É—Ç—ã –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤
- `/contracts/` - –°–ø–∏—Å–æ–∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –ø–æ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞–º
- `/contracts/device/<id>/` - –î–µ—Ç–∞–ª–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
- `/contracts/import/` - –ò–º–ø–æ—Ä—Ç –∏–∑ Excel

### –ú–∞—Ä—à—Ä—É—Ç—ã –µ–∂–µ–º–µ—Å—è—á–Ω—ã—Ö –æ—Ç—á–µ—Ç–æ–≤
- `/monthly-report/` - –°–ø–∏—Å–æ–∫ –æ—Ç—á–µ—Ç–æ–≤
- `/monthly-report/<id>/` - –î–µ—Ç–∞–ª–∏ –æ—Ç—á–µ—Ç–∞
- `/monthly-report/sync/` - –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∏–∑ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
- `/monthly-report/export/` - –≠–∫—Å–ø–æ—Ä—Ç –≤ Excel

### –û—Ç–ª–∞–¥–æ—á–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã (—Ç–æ–ª—å–∫–æ DEBUG=True)
- `/debug/errors/` - –ú–µ–Ω—é —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –æ—à–∏–±–æ–∫

---

## –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ
```bash
SECRET_KEY=<—Å–ª—É—á–∞–π–Ω–∞—è-—Å—Ç—Ä–æ–∫–∞-50-—Å–∏–º–≤–æ–ª–æ–≤>
DEBUG=False
DB_NAME=printer_inventory
DB_USER=postgres
DB_PASSWORD=<–Ω–∞–¥–µ–∂–Ω—ã–π-–ø–∞—Ä–æ–ª—å>
DB_HOST=localhost
DB_PORT=5432
REDIS_HOST=localhost
REDIS_PORT=6379
```

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
```bash
KEYCLOAK_SERVER_URL=http://localhost:8080
KEYCLOAK_REALM=printer-inventory
OIDC_CLIENT_ID=<–∏–∑-keycloak>
OIDC_CLIENT_SECRET=<–∏–∑-keycloak>
OIDC_VERIFY_SSL=True  # False —Ç–æ–ª—å–∫–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
```

### –°–µ—Ç—å
```bash
ALLOWED_HOSTS=localhost,127.0.0.1,example.com
CSRF_TRUSTED_ORIGINS=http://localhost:8000,https://example.com
BASE_URL=http://localhost:8000
USE_HTTPS=False  # True –¥–ª—è production
```

### GLPI Agent
```bash
GLPI_PATH=/usr/bin  # Linux: /usr/bin, Mac: /Applications/GLPI-Agent/bin
HTTP_CHECK=True  # –í–∫–ª—é—á–∏—Ç—å –≤–µ–±-–ø–∞—Ä—Å–∏–Ω–≥
POLL_INTERVAL_MINUTES=60
```

### –ó–∞—â–∏—Ç–∞ –æ—Ç –∞–Ω–æ–º–∞–ª—å–Ω—ã—Ö —Å—á–µ—Ç—á–∏–∫–æ–≤ (Kyocera bug protection)
```bash
# –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–∏–Ω—Ç–µ—Ä—ã Kyocera –∏–Ω–æ–≥–¥–∞ –æ—Ç–¥–∞—é—Ç –∑–∞–≤—ã—à–µ–Ω–Ω—ã–µ —Å—á–µ—Ç—á–∏–∫–∏
# –≠—Ç–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∑–∞—â–∏—â–∞—é—Ç –æ—Ç –∏–º–ø–æ—Ä—Ç–∞ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

# –õ–æ–≥–∏–∫–∞:
# 1. –ï—Å–ª–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–π –æ–ø—Ä–æ—Å –≤ —Ç–µ—á–µ–Ω–∏–µ 24 —á–∞—Å–æ–≤ –∏ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ > 5000 —Å—Ç—Ä–∞–Ω–∏—Ü ‚Üí –æ—Ç–∫–ª–æ–Ω—è–µ–º
# 2. –ï—Å–ª–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–π –æ–ø—Ä–æ—Å > 30 –¥–Ω–µ–π –Ω–∞–∑–∞–¥ ‚Üí –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É (–º–æ–≥ –ø–µ—á–∞—Ç–∞—Ç—å –ø–æ USB)

# –í—Ä–µ–º—è –º–µ–∂–¥—É –æ–ø—Ä–æ—Å–∞–º–∏ –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –°–¢–†–û–ì–û–ô –ø—Ä–æ–≤–µ—Ä–∫–∏ (—á–∞—Å—ã)
ANOMALY_CHECK_TIME_WINDOW_HOURS=24  # –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: 24 —á–∞—Å–∞

# –ü–æ—Ä–æ–≥ —É–≤–µ–ª–∏—á–µ–Ω–∏—è —Å—á–µ—Ç—á–∏–∫–∞, —Å—á–∏—Ç–∞—é—â–∏–π—Å—è –∞–Ω–æ–º–∞–ª—å–Ω—ã–º (—Å—Ç—Ä–∞–Ω–∏—Ü)
ANOMALY_JUMP_THRESHOLD=5000  # –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: 5,000 —Å—Ç—Ä–∞–Ω–∏—Ü

# –ü–µ—Ä–∏–æ–¥ –±–µ–∑ –æ–ø—Ä–æ—Å–æ–≤, –ø–æ—Å–ª–µ –∫–æ—Ç–æ—Ä–æ–≥–æ –ü–†–û–ü–£–°–ö–ê–ï–ú –ø—Ä–æ–≤–µ—Ä–∫—É (–¥–Ω–∏)
ANOMALY_SKIP_CHECK_DAYS=30  # –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: 30 –¥–Ω–µ–π
```

### –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ
```bash
REDIS_PASSWORD=<–µ—Å–ª–∏-—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω>
REDIS_DB=0
REDIS_SESSION_DB=1
REDIS_INVENTORY_DB=2
LOG_LEVEL=INFO  # DEBUG, INFO, WARNING, ERROR
```

---

## –û—Ç–ª–∞–¥–∫–∞ –∏ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –í–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞ DEBUG
```bash
python manage.py toggle_debug --on
```
**–ü–†–ï–î–£–ü–†–ï–ñ–î–ï–ù–ò–ï:** –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –≤–∫–ª—é—á–∞–π—Ç–µ –≤ production! –†–∞—Å–∫—Ä—ã–≤–∞–µ—Ç –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
```bash
# –û—à–∏–±–∫–∏ Django
tail -f logs/django.log

# Production –æ—à–∏–±–∫–∏
tail -f logs/errors.log

# –ó–∞–¥–∞—á–∏ Celery
tail -f logs/celery.log

# –ü—Ä–æ–±–ª–µ–º—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
tail -f logs/keycloak_auth.log
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ WebSockets
```javascript
// –ö–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞
const ws = new WebSocket('ws://localhost:5000/ws/inventory/');
ws.onmessage = (e) => console.log('–ü–æ–ª—É—á–µ–Ω–æ:', JSON.parse(e.data));
ws.send(JSON.stringify({type: 'test', message: 'hello'}));
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ Redis
```bash
redis-cli

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤
SMEMBERS inventory_updates

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫–ª—é—á–µ–π
KEYS *

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Å—Å–∏–∏
KEYS "django.contrib.sessions*"
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ Celery
```bash
# –ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏
celery -A printer_inventory inspect active

# –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏
celery -A printer_inventory inspect registered

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
celery -A printer_inventory inspect stats

# –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
python manage.py celery_monitor
```

### –ó–∞–ø—Ä–æ—Å—ã –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
```python
# –í –∫–æ–Ω—Å–æ–ª–∏ Django
from inventory.models import Printer

# –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ SQL
print(Printer.objects.filter(is_active=True).query)

# –ü–ª–∞–Ω –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞
print(Printer.objects.filter(is_active=True).explain())

# –ü–æ–¥—Å—á–µ—Ç –∑–∞–ø—Ä–æ—Å–æ–≤
from django.db import connection
print(len(connection.queries))
```

### –†–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

**–ü—Ä–æ–±–ª–µ–º–∞:** WebSockets –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç
**–†–µ—à–µ–Ω–∏–µ:** –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∑–∞–ø—É—â–µ–Ω Daphne (–Ω–µ runserver), Redis –¥–æ—Å—Ç—É–ø–µ–Ω, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—É—Ç—å `/ws/inventory/`

**–ü—Ä–æ–±–ª–µ–º–∞:** –ó–∞–¥–∞—á–∏ Celery –Ω–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è
**–†–µ—à–µ–Ω–∏–µ:** –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ worker –∑–∞–ø—É—â–µ–Ω, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ logs/celery.log, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Redis

**–ü—Ä–æ–±–ª–µ–º–∞:** –û—à–∏–±–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ OIDC
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ Keycloak –∑–∞–ø—É—â–µ–Ω, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ OIDC_CLIENT_ID/SECRET, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ logs/keycloak_auth.log

**–ü—Ä–æ–±–ª–µ–º–∞:** –û–ø—Ä–æ—Å –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å GLPI_PATH, —É–±–µ–¥–∏—Ç–µ—Å—å –≤ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ IP –ø—Ä–∏–Ω—Ç–µ—Ä–∞, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª–∞ —Ñ–∞–π—Ä–≤–æ–ª–∞

**–ü—Ä–æ–±–ª–µ–º–∞:** –û—à–∏–±–∫–∏ –∏–º–ø–æ—Ä—Ç–∞ –ø–æ—Å–ª–µ pull
**–†–µ—à–µ–Ω–∏–µ:** `pip install -r requirements.txt`, –∑–∞–ø—É—Å—Ç–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏, collectstatic

---

## –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞
- [ ] DEBUG=True (—Ç–æ–ª—å–∫–æ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)
- [ ] OIDC_VERIFY_SSL=False (–ø—Ä–∏–µ–º–ª–µ–º–æ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ Keycloak)
- [ ] –°–ª–∞–±—ã–π SECRET_KEY (–ø—Ä–∏–µ–º–ª–µ–º–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)

### Production
- [ ] DEBUG=False **–ö–†–ò–¢–ò–ß–ù–û**
- [ ] –ù–∞–¥–µ–∂–Ω—ã–π SECRET_KEY (50+ —Å–ª—É—á–∞–π–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤)
- [ ] ALLOWED_HOSTS –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- [ ] CSRF_TRUSTED_ORIGINS –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] USE_HTTPS=True
- [ ] OIDC_VERIFY_SSL=True
- [ ] –ù–∞–¥–µ–∂–Ω—ã–π –ø–∞—Ä–æ–ª—å –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- [ ] –ü–∞—Ä–æ–ª—å Redis —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
- [ ] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤ –±–µ–ª–æ–º —Å–ø–∏—Å–∫–µ –≤ —Ç–∞–±–ª–∏—Ü–µ AllowedUser
- [ ] –û—Ç–∫–ª—é—á–µ–Ω –Ω–µ–Ω—É–∂–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –∞–¥–º–∏–Ω–∫–µ Django
- [ ] SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- [ ] –†–∞–∑—Ä–µ—à–µ–Ω–∏—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ª–æ–≥–æ–≤ (chmod 700)
- [ ] –°—Ç—Ä–∞–Ω–∏—Ü—ã –æ—à–∏–±–æ–∫ –Ω–µ —Ä–∞—Å–∫—Ä—ã–≤–∞—é—Ç –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏

---

## –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
```python
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ select_related –¥–ª—è ForeignKey
printers = Printer.objects.select_related('organization').all()

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ prefetch_related –¥–ª—è ManyToMany/–æ–±—Ä–∞—Ç–Ω—ã—Ö FK
devices = ContractDevice.objects.prefetch_related('device_model__cartridges').all()

# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
class Meta:
    indexes = [
        models.Index(fields=['created_at', 'status']),
    ]

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ only() –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ–ª–µ–π
printers = Printer.objects.only('id', 'hostname', 'ip_address')

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ defer() –¥–ª—è –∏—Å–∫–ª—é—á–µ–Ω–∏—è –±–æ–ª—å—à–∏—Ö –ø–æ–ª–µ–π
printers = Printer.objects.defer('notes')
```

### –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
```python
from django.core.cache import cache

# –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ—Ä–æ–≥–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
def get_active_printers():
    key = 'active_printers_list'
    data = cache.get(key)
    if data is None:
        data = list(Printer.objects.filter(is_active=True))
        cache.set(key, data, 60 * 15)  # 15 –º–∏–Ω—É—Ç
    return data

# –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏
from django.db.models.signals import post_save

@receiver(post_save, sender=Printer)
def invalidate_printer_cache(sender, instance, **kwargs):
    cache.delete('active_printers_list')
```

### –ü–∞–≥–∏–Ω–∞—Ü–∏—è
```python
from django.core.paginator import Paginator

def printer_list(request):
    printers = Printer.objects.all()
    paginator = Paginator(printers, 50)  # 50 –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É
    page = paginator.get_page(request.GET.get('page', 1))
    return render(request, 'template.html', {'page': page})
```

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è Celery
```python
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –æ—á–µ—Ä–µ–¥–µ–π –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É
@shared_task(queue='high_priority')
def urgent_task():
    pass

# –ü–∞–∫–µ—Ç–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
@shared_task
def process_batch(item_ids):
    items = Item.objects.filter(id__in=item_ids)
    # –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–∞–∫–µ—Ç–æ–º
```

---

## –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

### –ü–µ—Ä–µ–¥ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ–º
- [ ] –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã: `python manage.py test`
- [ ] –ú–∏–≥—Ä–∞—Ü–∏–∏ —Å–æ–∑–¥–∞–Ω—ã: `python manage.py makemigrations --check`
- [ ] –ù–µ—Ç –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –º–∏–≥—Ä–∞—Ü–∏–π: `python manage.py migrate --plan`
- [ ] –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã —Å–æ–±—Ä–∞–Ω—ã: `python manage.py collectstatic`
- [ ] –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –≤ .env
- [ ] SECRET_KEY –æ–±–Ω–æ–≤–ª–µ–Ω
- [ ] DEBUG=False –ø—Ä–æ–≤–µ—Ä–µ–Ω

### –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- [ ] PostgreSQL —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] Redis —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] Realm Keycloak –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
- [ ] Nginx/Apache –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∫–∞–∫ –æ–±—Ä–∞—Ç–Ω—ã–π –ø—Ä–æ–∫—Å–∏
- [ ] –ü—Ä–∞–≤–∏–ª–∞ —Ñ–∞–π—Ä–≤–æ–ª–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- [ ] –°—Ç—Ä–∞—Ç–µ–≥–∏—è —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –≥–æ—Ç–æ–≤–∞

### –°–µ—Ä–≤–∏—Å—ã
- [ ] Daphne –∑–∞–ø—É—â–µ–Ω: `python -m daphne -b 0.0.0.0 -p 5000 printer_inventory.asgi:application`
- [ ] Celery workers –∑–∞–ø—É—â–µ–Ω—ã: `./start_workers.sh`
- [ ] Celery beat –∑–∞–ø—É—â–µ–Ω (–¥–ª—è –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∑–∞–¥–∞—á)
- [ ] –°–µ—Ä–≤–∏—Å—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –Ω–∞ –∞–≤—Ç–æ–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ (systemd)

### –ü–æ—Å–ª–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è
- [ ] –ú–∏–≥—Ä–∞—Ü–∏–∏ –∑–∞–ø—É—â–µ–Ω—ã: `python manage.py migrate`
- [ ] –°–æ–∑–¥–∞–Ω —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: `python manage.py createsuperuser`
- [ ] –î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–∞—á–∞–ª—å–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤ –±–µ–ª—ã–π —Å–ø–∏—Å–æ–∫
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω –ø—Ä–æ—Ü–µ—Å—Å –≤—Ö–æ–¥–∞
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω –æ–ø—Ä–æ—Å (—Ä—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫)
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω—ã WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω—ã —Å—Ç—Ä–∞–Ω–∏—Ü—ã –æ—à–∏–±–æ–∫ (–≤—ã–∑–æ–≤ 404, 500)
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–æ–≥–æ–≤ –Ω–∞ –æ—à–∏–±–∫–∏
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω–∞ —Ä–æ—Ç–∞—Ü–∏—è –ª–æ–≥–æ–≤
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥/–æ–ø–æ–≤–µ—â–µ–Ω–∏—è

---

## –°—Ç—Ä–∞—Ç–µ–≥–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### Unit —Ç–µ—Å—Ç—ã
```python
from django.test import TestCase
from inventory.models import Printer

class PrinterModelTest(TestCase):
    def setUp(self):
        self.printer = Printer.objects.create(
            hostname='test-printer',
            ip_address='192.168.1.100'
        )

    def test_printer_creation(self):
        self.assertEqual(self.printer.hostname, 'test-printer')

    def test_str_method(self):
        self.assertIn('test-printer', str(self.printer))
```

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
```python
from django.test import Client, TestCase

class PrinterViewTest(TestCase):
    def setUp(self):
        self.client = Client()
        # –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –≤—Ö–æ–¥

    def test_printer_list_view(self):
        response = self.client.get('/inventory/')
        self.assertEqual(response.status_code, 200)
        self.assertTemplateUsed(response, 'inventory/printer_list.html')
```

### –¢–µ—Å—Ç—ã –∑–∞–¥–∞—á Celery
```python
from inventory.tasks import run_inventory_task_priority

class TaskTest(TestCase):
    def test_polling_task(self):
        printer = Printer.objects.create(...)
        result = run_inventory_task_priority.apply(args=[printer.id])
        self.assertTrue(result.successful())
```

---

## –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ –º–∏–≥—Ä–∞—Ü–∏–π

### –°–æ–∑–¥–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π
```bash
# –í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ, —á—Ç–æ –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–æ
python manage.py makemigrations --dry-run

# –°–æ–∑–¥–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏
python manage.py makemigrations

# –ü—Ä–æ—Å–º–æ—Ç—Ä —Ñ–∞–π–ª–∞ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø–µ—Ä–µ–¥ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º!
cat inventory/migrations/0XXX_*.py

# –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Å –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–æ–º –ø–ª–∞–Ω–∞
python manage.py migrate --plan

# –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ
python manage.py migrate
```

### –ú–∏–≥—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö
```python
# –°–æ–∑–¥–∞–Ω–∏–µ –ø—É—Å—Ç–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏
python manage.py makemigrations --empty inventory

# –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ –º–∏–≥—Ä–∞—Ü–∏–∏
from django.db import migrations

def populate_data(apps, schema_editor):
    Printer = apps.get_model('inventory', 'Printer')
    # –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

def reverse_data(apps, schema_editor):
    # –û–±—Ä–∞—Ç–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è

class Migration(migrations.Migration):
    dependencies = [
        ('inventory', '0XXX_previous'),
    ]

    operations = [
        migrations.RunPython(populate_data, reverse_data),
    ]
```

### –û—Ç–∫–∞—Ç
```bash
# –û—Ç–∫–∞—Ç –ø–æ—Å–ª–µ–¥–Ω–µ–π –º–∏–≥—Ä–∞—Ü–∏–∏
python manage.py migrate inventory 0XXX_previous_migration

# –û—Ç–∫–∞—Ç –≤—Å–µ—Ö –º–∏–≥—Ä–∞—Ü–∏–π –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
python manage.py migrate inventory zero
```

---

## Git —Ä–∞–±–æ—á–∏–π –ø—Ä–æ—Ü–µ—Å—Å

### –°—Ç—Ä–∞—Ç–µ–≥–∏—è –≤–µ—Ç–æ–∫
- **main** - –ì–æ—Ç–æ–≤—ã–π –∫ production –∫–æ–¥
- **claude/claude-md-mi2q74wa992fojfo-012g2tXZiXDou9JDBK88v3tX** - –¢–µ–∫—É—â–∞—è –≤–µ—Ç–∫–∞ —Ñ—É–Ω–∫—Ü–∏–π (—Ä–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ –∑–¥–µ—Å—å!)

### –°–æ–æ–±—â–µ–Ω–∏—è –∫–æ–º–º–∏—Ç–æ–≤
```
# –•–æ—Ä–æ—à–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∫–æ–º–º–∏—Ç–æ–≤
–î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –≤–µ–±-–ø–∞—Ä—Å–∏–Ω–≥–∞ –¥–ª—è –ø—Ä–∏–Ω—Ç–µ—Ä–æ–≤ HP
Fix: –£—Å—Ç—Ä–∞–Ω–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ —Ç–∞–π–º–∞—É—Ç–∞ –æ–ø—Ä–æ—Å–∞ (#123)
Refactor: –ò–∑–≤–ª–µ—á–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ SNMP –≤ —Å–ª–æ–π —Å–µ—Ä–≤–∏—Å–æ–≤
Update: –£–≤–µ–ª–∏—á–µ–Ω TTL –∫—ç—à–∞ –¥–ª—è –¥–∞–Ω–Ω—ã—Ö –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è

# –ü–ª–æ—Ö–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∫–æ–º–º–∏—Ç–æ–≤
–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞
–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
WIP
asdf
```

### –†–∞–±–æ—á–∏–π –ø—Ä–æ—Ü–µ—Å—Å Pull Request
```bash
# –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –≤–µ—Ç–∫–µ
git checkout claude/claude-md-mi2q74wa992fojfo-012g2tXZiXDou9JDBK88v3tX

# –í–Ω–µ—Å–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è, –∑–∞–∫–æ–º–º–∏—Ç—å—Ç–µ
git add .
git commit -m "–î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è X"

# Push (–ö–†–ò–¢–ò–ß–ù–û: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–ª–∞–≥ -u –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ push)
git push -u origin claude/claude-md-mi2q74wa992fojfo-012g2tXZiXDou9JDBK88v3tX

# –°–æ–∑–¥–∞–Ω–∏–µ PR —á–µ—Ä–µ–∑ UI GitHub –∏–ª–∏ gh CLI
gh pr create --title "–§—É–Ω–∫—Ü–∏—è X" --body "–û–ø–∏—Å–∞–Ω–∏–µ..."
```

---

## –¢–∏–ø–∏—á–Ω—ã–µ –∑–∞–¥–∞—á–∏ –¥–ª—è AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–≤

### –ó–∞–¥–∞—á–∞: –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –∞—Ç—Ä–∏–±—É—Ç –ø—Ä–∏–Ω—Ç–µ—Ä–∞
1. –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ –≤ –º–æ–¥–µ–ª—å `Printer` –≤ `inventory/models.py`
2. –ó–∞–ø—É—Å—Ç–∏—Ç—å `python manage.py makemigrations`
3. –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é, –∑–∞—Ç–µ–º `python manage.py migrate`
4. –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ –≤ `PrinterForm` –≤ `inventory/forms.py`
5. –û–±–Ω–æ–≤–∏—Ç—å —à–∞–±–ª–æ–Ω –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ–ª—è
6. –û–±–Ω–æ–≤–∏—Ç—å –∞–¥–º–∏–Ω–∫—É –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
7. –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç

### –ó–∞–¥–∞—á–∞: –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π API —ç–Ω–¥–ø–æ–∏–Ω—Ç
1. –î–æ–±–∞–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é –≤ `inventory/views/api_views.py`
2. –î–æ–±–∞–≤–∏—Ç—å URL –ø–∞—Ç—Ç–µ—Ä–Ω –≤ `inventory/urls.py`
3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å curl –∏–ª–∏ Postman
4. –ó–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ —ç—Ç–æ–º —Ñ–∞–π–ª–µ (—Ä–∞–∑–¥–µ–ª API)
5. –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç

### –ó–∞–¥–∞—á–∞: –ò—Å–ø—Ä–∞–≤–∏—Ç—å –æ—à–∏–±–∫—É –æ–ø—Ä–æ—Å–∞
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `logs/celery.log` –Ω–∞ –æ—à–∏–±–∫–∏ –∑–∞–¥–∞—á
2. –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `inventory/services.py`
3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –æ–¥–Ω–æ–º –ø—Ä–∏–Ω—Ç–µ—Ä–µ: –∑–∞–ø—É—Å—Ç–∏—Ç—å —Ä—É—á–Ω–æ–π –æ–ø—Ä–æ—Å
4. –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—É
5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø—Ä–∏–Ω—Ç–µ—Ä–∞—Ö
6. –û–±–Ω–æ–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
7. –ó–∞–∫–æ–º–º–∏—Ç–∏—Ç—å —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º "Fix:"

### –ó–∞–¥–∞—á–∞: –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –º–µ–¥–ª–µ–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å
1. –í–∫–ª—é—á–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ settings (DEBUG=True –≤—Ä–µ–º–µ–Ω–Ω–æ)
2. –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –º–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
3. –î–æ–±–∞–≤–∏—Ç—å `select_related()` –∏–ª–∏ `prefetch_related()`
4. –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–µ–∫—Å—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
5. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —É–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
6. –ó–∞–∫–æ–º–º–∏—Ç–∏—Ç—å —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º "Optimize:"

### –ó–∞–¥–∞—á–∞: –î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—É—é –∑–∞–¥–∞—á—É
1. –°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É –≤ `inventory/tasks.py`
2. –î–æ–±–∞–≤–∏—Ç—å –≤ `CELERY_BEAT_SCHEDULE` –≤ `settings.py`
3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å: `celery -A printer_inventory beat --loglevel=debug`
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –∏–Ω—Ç–µ—Ä–≤–∞–ª–µ
5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
6. –ó–∞–∫–æ–º–º–∏—Ç–∏—Ç—å

---

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- Django: https://docs.djangoproject.com/
- Celery: https://docs.celeryproject.org/
- Django Channels: https://channels.readthedocs.io/
- Keycloak: https://www.keycloak.org/documentation
- Alpine.js: https://alpinejs.dev/
- Bootstrap 5: https://getbootstrap.com/docs/5.0/

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞
- `/docs/CODEBASE_OVERVIEW.md` - –ü–æ–¥—Ä–æ–±–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–¥–æ–≤–æ–π –±–∞–∑—ã
- `/docs/QUICK_REFERENCE.md` - –ö—Ä–∞—Ç–∫–∞—è —Å–ø—Ä–∞–≤–∫–∞
- `/docs/ERROR_HANDLING.md` - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –æ–±—Ä–∞–±–æ—Ç–∫–µ –æ—à–∏–±–æ–∫
- `/README.md` - –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –∏—Å—Ç–æ—Ä–∏–∏ git
git log --oneline | head -20
git log --graph --online --all

# –ü–æ–∏—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–æ–º–º–∏—Ç–∞
git log --grep="polling"
git log --author="username"

# –ü—Ä–æ—Å–º–æ—Ç—Ä –∏—Å—Ç–æ—Ä–∏–∏ —Ñ–∞–π–ª–∞
git log --follow -- inventory/services.py

# Blame (–∫—Ç–æ —á—Ç–æ –∏–∑–º–µ–Ω–∏–ª)
git blame inventory/services.py

# –ü–æ–∏—Å–∫ –≤ –∫–æ–¥–æ–≤–æ–π –±–∞–∑–µ
grep -r "function_name" .
grep -r "TODO" . --exclude-dir=venv
```

---

## –ó–∞–º–µ—Ç–∫–∏ –¥–ª—è AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–≤

### –ü—Ä–∏ –Ω–∞—á–∞–ª–µ –∑–∞–¥–∞—á–∏
1. **–°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ—á–∏—Ç–∞–π—Ç–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —Ñ–∞–π–ª—ã** - –ù–µ –¥–µ–ª–∞–π—Ç–µ –ø—Ä–µ–¥–ø–æ–ª–æ–∂–µ–Ω–∏–π
2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∫–æ–º–º–∏—Ç—ã** - –ü–æ–π–º–∏—Ç–µ –Ω–µ–¥–∞–≤–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
3. **–ü—Ä–æ—Å–º–æ—Ç—Ä–∏—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã** - –°–ª–µ–¥—É–π—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–º —Å–æ–≥–ª–∞—à–µ–Ω–∏—è–º
4. **–ü–ª–∞–Ω–∏—Ä—É–π—Ç–µ –ø–µ—Ä–µ–¥ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ–º** - –†–∞–∑–±–µ–π—Ç–µ —Å–ª–æ–∂–Ω—ã–µ –∑–∞–¥–∞—á–∏
5. **–ó–∞–ø—Ä–∞—à–∏–≤–∞–π—Ç–µ —É—Ç–æ—á–Ω–µ–Ω–∏—è** - –ï—Å–ª–∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –Ω–µ—è—Å–Ω—ã

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∫–æ–¥–∞
1. **–í–°–ï–ì–î–ê —á–∏—Ç–∞–π—Ç–µ —Ñ–∞–π–ª—ã –ø–µ—Ä–µ–¥ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º** - –°–Ω–∞—á–∞–ª–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç Read
2. **–°–æ—Ö—Ä–∞–Ω—è–π—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã** - –ù–µ –≤–≤–æ–¥–∏—Ç–µ –Ω–æ–≤—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –±–µ–∑ –ø—Ä–∏—á–∏–Ω—ã
3. **–û–±–Ω–æ–≤–ª—è–π—Ç–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã** - –§–æ—Ä–º—ã, –∞–¥–º–∏–Ω–∫–∞, —à–∞–±–ª–æ–Ω—ã, —Ç–µ—Å—Ç—ã
4. **–¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è** - –ó–∞–ø—É—Å–∫–∞–π—Ç–µ —Ç–µ—Å—Ç—ã –ø–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º
5. **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è** - –û–±–Ω–æ–≤–ª—è–π—Ç–µ —ç—Ç–æ—Ç CLAUDE.md –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

### –†–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–Ω—ã–µ –ª–æ–≤—É—à–∫–∏, –∫–æ—Ç–æ—Ä—ã—Ö —Å–ª–µ–¥—É–µ—Ç –∏–∑–±–µ–≥–∞—Ç—å
- –ù–µ –∏–∑–º–µ–Ω—è–π—Ç–µ —Ñ–∞–π–ª—ã `migrations/` –Ω–∞–ø—Ä—è–º—É—é (–≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ makemigrations)
- –ù–µ —Ö–∞—Ä–¥–∫–æ–¥—å—Ç–µ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è)
- –ù–µ –ø—Ä–æ–ø—É—Å–∫–∞–π—Ç–µ –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ (–æ–±–æ—Ä–∞—á–∏–≤–∞–π—Ç–µ —Ä–∏—Å–∫–æ–≤–∞–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ try/except)
- –ù–µ –∑–∞–±—ã–≤–∞–π—Ç–µ –æ–±–Ω–æ–≤–ª—è—Ç—å —Ç–µ—Å—Ç—ã –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–æ–¥–∞
- –ù–µ –∫–æ–º–º–∏—Ç—å—Ç–µ —Å DEBUG=True
- –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–æ–¥ –≤ –∑–∞–¥–∞—á–∞—Ö Celery –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ .objects.select_for_update())
- –ù–µ –∑–∞–±—ã–≤–∞–π—Ç–µ –∏–Ω–≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –∫—ç—à –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö

### –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–ø–∏—Å–∞—Ç–µ–ª—å–Ω—ã–µ –∏–º–µ–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
- –î–µ—Ä–∂–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Å—Ñ–æ–∫—É—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ (–µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å)
- –î–æ–±–∞–≤–ª—è–π—Ç–µ docstrings –∫ —Å–ª–æ–∂–Ω—ã–º —Ñ—É–Ω–∫—Ü–∏—è–º
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏ —Ç–∏–ø–æ–≤, –≥–¥–µ —ç—Ç–æ –ø–æ–ª–µ–∑–Ω–æ
- –õ–æ–≥–∏—Ä—É–π—Ç–µ –≤–∞–∂–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ –≥—Ä–∞–Ω–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏
- –ü–∏—à–∏—Ç–µ —Ç–µ—Å—Ç—ã –¥–ª—è –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
- –î–µ–ª–∞–π—Ç–µ –∞—Ç–æ–º–∞—Ä–Ω—ã–µ –∫–æ–º–º–∏—Ç—ã (–æ–¥–Ω–æ –ª–æ–≥–∏—á–µ—Å–∫–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –Ω–∞ –∫–æ–º–º–∏—Ç)

---

## –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

### –ù–æ—è–±—Ä—å 2025 - –£–ª—É—á—à–µ–Ω–∏—è UI/UX –∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

#### –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —à–∞–ø–∫–∞ —Ç–∞–±–ª–∏—Ü—ã monthly_report (22 –Ω–æ—è–±—Ä—è 2025)
**–ö–æ–º–º–∏—Ç—ã:** `d4961c8`, `2dab676`, `47f8385`, `36109df`, `66fab25`, `f839b64`

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ì—Ä—É–ø–ø–æ–≤–∞—è —à–∞–ø–∫–∞ —Ç–∞–±–ª–∏—Ü—ã ("–°—á—ë—Ç—á–∏–∫–∏ A4", "–°—á—ë—Ç—á–∏–∫–∏ A3") –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–ª–∞ —Ü–µ–Ω–Ω–æ—Å—Ç–∏
- –û—Ç–æ–±—Ä–∞–∂–∞–ª–∞—Å—å –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø—Ä–∏ —Å–∫—Ä—ã—Ç–∏–∏ —Å—Ç–æ–ª–±—Ü–æ–≤
- –®–∞–ø–∫–∞ —Ç–∞–±–ª–∏—Ü—ã —Å–∫—Ä—ã–≤–∞–ª–∞—Å—å –ø—Ä–∏ –ø—Ä–æ–∫—Ä—É—Ç–∫–µ –≤–Ω–∏–∑
- –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π —Å–∫—Ä–æ–ª–ª –¥–≤–∏–≥–∞–ª navbar —Å–∞–π—Ç–∞

**–†–µ—à–µ–Ω–∏–µ:**
1. –£–¥–∞–ª–µ–Ω–∞ –≥—Ä—É–ø–ø–æ–≤–∞—è —à–∞–ø–∫–∞ –∏–∑ `MonthReportTable.vue`
2. –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —à–∞–ø–∫–∞ —á–µ—Ä–µ–∑ JavaScript –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ:
   - –ü—Ä–∏ –ø—Ä–æ–∫—Ä—É—Ç–∫–µ –≤–Ω–∏–∑ —Å–æ–∑–¥–∞—ë—Ç—Å—è –∫–ª–æ–Ω –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–π —à–∞–ø–∫–∏
   - –ö–ª–æ–Ω –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç—Å—è —Å `position: fixed` –ø–æ–¥ navbar
   - –¢–æ—á–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —à–∏—Ä–∏–Ω—ã —Å—Ç–æ–ª–±—Ü–æ–≤ —á–µ—Ä–µ–∑ `getBoundingClientRect()`
   - –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ —Å–∫—Ä–æ–ª–ª–∞
3. Navbar –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω —á–µ—Ä–µ–∑ `position: fixed`
4. –ù–∞ body —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω `overflow-x: hidden`
5. –î–æ–±–∞–≤–ª–µ–Ω `margin-top: 56px` –¥–ª—è –≥–ª–∞–≤–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

**–ó–∞—Ç—Ä–æ–Ω—É—Ç—ã–µ —Ñ–∞–π–ª—ã:**
- `frontend/src/components/monthly-report/MonthReportTable.vue`
- `monthly_report/templates/monthly_report/month_detail_vue.html`

#### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ Keycloak (22 –Ω–æ—è–±—Ä—è 2025)
**–ö–æ–º–º–∏—Ç—ã:** `8215a08`, `eae87db`, `5a09966`, `b9bca62`, `25debbf`, `c86460c`, `5a4307e`, `30faf80`, `59a8ea3`, `0c5c1b7`, `838c733`, `1488112`, `c841076`

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ù–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥–µ–ª–∏ 404 –∏–ª–∏ 403 –æ—à–∏–±–∫–∏
- –ù—É–∂–Ω–æ –±—ã–ª–æ –≤—Ä—É—á–Ω—É—é –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤—Ö–æ–¥–∞
- –û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Keycloak –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –°–µ—Å—Å–∏—è –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–ª–∞—Å—å –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ OIDC
- –ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª —Ä–µ–¥–∏—Ä–µ–∫—Ç–æ–≤ –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –≤—Ö–æ–¥–∞

**–†–µ—à–µ–Ω–∏–µ:**
1. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–¥–∏—Ä–µ–∫—Ç:**
   - –ü—Ä–∏ –¥–æ—Å—Ç—É–ø–µ –∫ –∑–∞—â–∏—â—ë–Ω–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ Keycloak
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ URL –≤ —Å–µ—Å—Å–∏–∏ –¥–ª—è —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞ –ø–æ—Å–ª–µ –≤—Ö–æ–¥–∞
   - –ü—Ä–∏ –æ—à–∏–±–∫–µ Keycloak ‚Üí –ø–æ–∫–∞–∑ Django —Ñ–æ—Ä–º—ã –ª–æ–≥–∏–Ω–∞ —Å toast —Å–æ–æ–±—â–µ–Ω–∏–µ–º

2. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏–π:**
   - –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—ë–Ω –º–µ—Ç–æ–¥ `get()` –≤ `CustomOIDCCallbackView` –≤–º–µ—Å—Ç–æ `login_success()`
   - –£–±—Ä–∞–Ω—ã –¥—É–±–ª–∏—Ä—É—é—â–∏–µ –≤—ã–∑–æ–≤—ã `auth_login()`
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ `SESSION_COOKIE_SAMESITE = 'Lax'` –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –ø–µ—Ä–µ–¥–∞—á–∏ cookie –ø—Ä–∏ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞—Ö

3. **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –ø—Ä–∞–≤:**
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –≥—Ä—É–ø–ø—ã "–ù–∞–±–ª—é–¥–∞—Ç–µ–ª—å" –Ω–æ–≤—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º Keycloak
   - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `update_user()` –¥–ª—è –≤—ã–∑–æ–≤–∞ `assign_default_groups()`

4. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:**
   - –£–±—Ä–∞–Ω—ã —Ñ–ª–∞–≥–∏ `raise_exception=True` –∏–∑ view —Å LoginRequiredMixin/PermissionRequiredMixin
   - –¢–µ–ø–µ—Ä—å –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤—Ö–æ–¥–∞ –≤–º–µ—Å—Ç–æ 403

**–ó–∞—Ç—Ä–æ–Ω—É—Ç—ã–µ —Ñ–∞–π–ª—ã:**
- `printer_inventory/auth_views.py` - –Ω–æ–≤—ã–π `CustomOIDCCallbackView`
- `printer_inventory/auth_backends.py` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω `update_user()`
- `printer_inventory/settings.py` - –¥–æ–±–∞–≤–ª–µ–Ω `SESSION_COOKIE_SAMESITE`
- `monthly_report/views.py` - —É–±—Ä–∞–Ω `raise_exception`
- `contracts/views.py` - —É–±—Ä–∞–Ω `raise_exception`
- `templates/registration/login_choice.html` - –æ–±–Ω–æ–≤–ª—ë–Ω UI

#### –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤—ã–±–æ—Ä–∞ —Å–ø–æ—Å–æ–±–∞ –≤—Ö–æ–¥–∞ –ø–æ—Å–ª–µ logout (22 –Ω–æ—è–±—Ä—è 2025)
**–ö–æ–º–º–∏—Ç—ã:** `6ba8819`

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ü–æ—Å–ª–µ –≤—ã—Ö–æ–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å—Ä–∞–∑—É –∂–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤—ã–≤–∞–ª—Å—è –æ–±—Ä–∞—Ç–Ω–æ —á–µ—Ä–µ–∑ Keycloak
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –±—ã–ª–æ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –º–µ–∂–¥—É —É—á—ë—Ç–Ω—ã–º–∏ –∑–∞–ø–∏—Å—è–º–∏
- Keycloak —Å–µ—Å—Å–∏—è –æ—Å—Ç–∞–≤–∞–ª–∞—Å—å –∞–∫—Ç–∏–≤–Ω–æ–π –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤—ã–≤–∞–ª–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–†–µ—à–µ–Ω–∏–µ:**
1. –î–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä `?manual=1` –≤ URL —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤—Ö–æ–¥–∞
2. –°–æ–∑–¥–∞–Ω `custom_logout()` view:
   - –í—ã–ø–æ–ª–Ω—è–µ—Ç logout –∏–∑ Django
   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ "–í—ã —É—Å–ø–µ—à–Ω–æ –≤—ã—à–ª–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã"
   - –†–µ–¥–∏—Ä–µ–∫—Ç–∏—Ç –Ω–∞ `/accounts/login/?manual=1`
3. –û–±–Ω–æ–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ `login_choice()`:
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä `manual`
   - –ü—Ä–∏ `manual=1` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ñ–æ—Ä–º—É –≤—ã–±–æ—Ä–∞ –≤—Ö–æ–¥–∞ –≤–º–µ—Å—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞

**–ó–∞—Ç—Ä–æ–Ω—É—Ç—ã–µ —Ñ–∞–π–ª—ã:**
- `printer_inventory/auth_views.py` - –¥–æ–±–∞–≤–ª–µ–Ω `custom_logout()`
- `printer_inventory/urls.py` - –ø–æ–¥–∫–ª—é—á—ë–Ω `custom_logout` –∫ `/accounts/logout/`

**–¢–µ–ø–µ—Ä—å –ø–æ—Å–ª–µ logout:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤—ã–±–æ—Ä–∞ —Å–ø–æ—Å–æ–±–∞ –≤—Ö–æ–¥–∞
- –ú–æ–∂–µ—Ç –≤–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Keycloak (–≤–æ–∑–º–æ–∂–Ω–æ —Å –¥—Ä—É–≥–æ–π —É—á—ë—Ç–Ω–æ–π –∑–∞–ø–∏—Å—å—é)
- –ú–æ–∂–µ—Ç –≤–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Django –ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å
- –ú–æ–∂–µ—Ç –ø—Ä–æ—Å—Ç–æ –∑–∞–∫—Ä—ã—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É

---

### –ò–º–ø–æ—Ä—Ç –ø—Ä–∏–Ω—Ç–µ—Ä–æ–≤ –∏–∑ Excel (14 —è–Ω–≤–∞—Ä—è 2026)
**–ö–æ–º–º–∏—Ç:** (—Ç–µ–∫—É—â–∏–π)

**–ü—Ä–æ–±–ª–µ–º–∞:**
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ö–æ—Ç–µ–ª –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é –∏ –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–∏–Ω—Ç–µ—Ä—ã –Ω–∞ –æ–ø—Ä–æ—Å, –Ω–æ –Ω–µ –¥–æ–±–∞–≤–ª—è—Ç—å –∏—Ö —Å—Ä–∞–∑—É –≤ "—É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –≤ –¥–æ–≥–æ–≤–æ—Ä–µ" (contracts). –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å –∏—Ö —á–µ—Ä–µ–∑ 3 –º–µ—Å—è—Ü–∞ –ø–æ—Å–ª–µ –∑–∞–∫–ª—é—á–µ–Ω–∏—è –¥–æ–≥–æ–≤–æ—Ä–∞, –Ω–æ –¥–∞–Ω–Ω—ã–µ –Ω—É–∂–Ω–æ –±—ã–ª–æ –Ω–∞—á–∞—Ç—å —Å–æ–±–∏—Ä–∞—Ç—å —Å—Ä–∞–∑—É.

**–í—ã—è–≤–ª–µ–Ω–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã:**
1. –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –ø—Ä–∏–Ω—Ç–µ—Ä–æ–≤ –Ω–µ –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Å—Ç–∞–≤–ª—è—Ç—å—Å—è –º–æ–¥–µ–ª—å –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å
2. –û–ø–∞—Å–µ–Ω–∏—è –∫–æ–ª–ª–∏–∑–∏–π —Å–µ—Ä–∏–π–Ω–∏–∫–æ–≤ —Å –ø—Ä–æ—à–∏—Ç—ã–º–∏ –º–æ–¥–µ–ª—è–º–∏

**–†–µ—à–µ–Ω–∏–µ:**

1. **–°–æ–∑–¥–∞–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ `import_printers_xlsx`** - –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –∏–º–ø–æ—Ä—Ç –ø—Ä–∏–Ω—Ç–µ—Ä–æ–≤ –∏–∑ Excel/CSV:
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–ª–ª–∏–∑–∏–π IP/MAC –∞–¥—Ä–µ—Å–æ–≤ –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π (`--auto-create-org`)
   - –ü—Ä–æ–ø—É—Å–∫ –∫–æ–ª–ª–∏–∑–∏–π (`--skip-collisions`)
   - Dry-run —Ä–µ–∂–∏–º –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
   - –î–µ—Ç–∞–ª—å–Ω—ã–π –≤—ã–≤–æ–¥ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

2. **Workflow –∏–º–ø–æ—Ä—Ç–∞ –Ω–æ–≤–æ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏:**
   ```bash
   # 1. –ò–º–ø–æ—Ä—Ç –ø—Ä–∏–Ω—Ç–µ—Ä–æ–≤
   python manage.py import_printers_xlsx printers.xlsx --auto-create-org

   # 2. –û–ø—Ä–æ—Å –ø—Ä–∏–Ω—Ç–µ—Ä–æ–≤ (—á–µ—Ä–µ–∑ web UI)

   # 3. –ü—Ä–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π –∏–∑ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞
   python manage.py migrate_models_to_devicemodel

   # 4. –ß–µ—Ä–µ–∑ 3 –º–µ—Å—è—Ü–∞: –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ contracts
   python manage.py contracts_import_xlsx –¥–æ–≥–æ–≤–æ—Ä.xlsx
   python manage.py link_devices_by_serial
   ```

3. **–†–∞–∑—ä—è—Å–Ω–µ–Ω–∏—è –ø–æ –º–æ–¥–µ–ª—è–º:**
   - `Printer.device_model` - nullable, –ø—Ä–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –ü–û–°–õ–ï –ø–µ—Ä–≤–æ–≥–æ –æ–ø—Ä–æ—Å–∞
   - SNMP –æ–ø—Ä–æ—Å –∑–∞–ø–æ–ª–Ω—è–µ—Ç —Ç–µ–∫—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ `Printer.model` (–Ω–∞–ø—Ä–∏–º–µ—Ä, "Ricoh MP C2004")
   - –ö–æ–º–∞–Ω–¥–∞ `migrate_models_to_devicemodel` –Ω–∞—Ö–æ–¥–∏—Ç –º–æ–¥–µ–ª—å –≤ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–µ `DeviceModel` –∏ –ø—Ä–æ—Å—Ç–∞–≤–ª—è–µ—Ç FK

4. **–†–∞–∑—ä—è—Å–Ω–µ–Ω–∏—è –ø–æ —Å–µ—Ä–∏–π–Ω–∏–∫–∞–º:**
   - `Printer.serial_number` - –ù–ï unique (–º–æ–∂–Ω–æ –∏–º–µ—Ç—å –¥—É–±–ª–∏–∫–∞—Ç—ã)
   - `Printer.mac_address` - unique
   - `Printer.ip_address` - unique
   - `ContractDevice.serial_number` - unique —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ –æ–¥–Ω–æ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
   - –ö–æ–ª–ª–∏–∑–∏–∏ MAC/IP —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏—Å–∫–ª—é—á–µ–Ω—ã (—Ä–∞–∑–Ω—ã–µ –∞–¥—Ä–µ—Å–∞)

**–ó–∞—Ç—Ä–æ–Ω—É—Ç—ã–µ —Ñ–∞–π–ª—ã:**
- `inventory/management/commands/import_printers_xlsx.py` - –Ω–æ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞ –∏–º–ø–æ—Ä—Ç–∞
- `docs/PRINTER_IMPORT_GUIDE.md` - –ø–æ–¥—Ä–æ–±–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ
- `docs/QUICK_START_NEW_ORG.md` - –±—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –¥–ª—è –Ω–æ–≤–æ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
- `docs/printer_import_example.csv` - –ø—Ä–∏–º–µ—Ä CSV –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞
- `CLAUDE.md` - –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∫–æ–º–∞–Ω–¥

**–¢–µ–ø–µ—Ä—å:**
- –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –∏–º–ø–æ—Ä—Ç –ø—Ä–∏–Ω—Ç–µ—Ä–æ–≤ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –∫–æ–ª–ª–∏–∑–∏–π
- –ß–µ—Ç–∫–∏–π workflow: –∏–º–ø–æ—Ä—Ç ‚Üí –æ–ø—Ä–æ—Å ‚Üí –º–∏–≥—Ä–∞—Ü–∏—è –º–æ–¥–µ–ª–µ–π ‚Üí (—á–µ—Ä–µ–∑ 3 –º–µ—Å—è—Ü–∞) contracts
- –î–µ—Ç–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2026-01-14
**–°–æ–ø—Ä–æ–≤–æ–∂–¥–∞—é—â–∏–π:** AI Assistant
**–°—Ç–∞—Ç—É—Å:** –ê–∫—Ç–∏–≤–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω –æ–±–Ω–æ–≤–ª—è—Ç—å—Å—è –ø—Ä–∏ –≤–Ω–µ—Å–µ–Ω–∏–∏ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –∫–æ–¥–æ–≤–æ–π –±–∞–∑—ã, —Ä–∞–±–æ—á–∏–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –∏–ª–∏ —Å–æ–≥–ª–∞—à–µ–Ω–∏—è.
