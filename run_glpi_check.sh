#!/bin/bash

# ============================================================================
# –°–∫—Ä–∏–ø—Ç –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ GLPI
# ============================================================================

set -e

echo "=================================================="
echo "üöÄ –ó–ê–ü–£–°–ö –ü–†–û–í–ï–†–ö–ò –£–°–¢–†–û–ô–°–¢–í –í GLPI"
echo "=================================================="
echo ""

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞—Ä–≥—É–º–µ–Ω—Ç—ã
MODE="${1:-async}"

case $MODE in
    sync|--sync|-s)
        echo "üìä –†–µ–∂–∏–º: –°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π (—Å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å–∞)"
        echo ""
        python manage.py check_glpi --sync
        ;;

    async|--async|-a)
        echo "üîÑ –†–µ–∂–∏–º: –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π (–∑–∞–ø—É—Å–∫ –≤ —Ñ–æ–Ω–µ)"
        echo ""
        python manage.py check_glpi
        ;;

    status|--status)
        if [ -z "$2" ]; then
            echo "‚ùå –û—à–∏–±–∫–∞: —É–∫–∞–∂–∏—Ç–µ ID –∑–∞–¥–∞—á–∏"
            echo "   –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: $0 status TASK_ID"
            exit 1
        fi
        python manage.py check_glpi --status "$2"
        ;;

    help|--help|-h)
        echo "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: $0 [—Ä–µ–∂–∏–º]"
        echo ""
        echo "–†–µ–∂–∏–º—ã:"
        echo "  sync, --sync, -s      –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)"
        echo "  async, --async, -a    –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤ —Ñ–æ–Ω–µ"
        echo "  status TASK_ID        –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏"
        echo "  help, --help, -h      –ü–æ–∫–∞–∑–∞—Ç—å —ç—Ç—É —Å–ø—Ä–∞–≤–∫—É"
        echo ""
        echo "–ü—Ä–∏–º–µ—Ä—ã:"
        echo "  $0                    # –ó–∞–ø—É—Å–∫ –≤ —Ñ–æ–Ω–µ"
        echo "  $0 sync               # –ó–∞–ø—É—Å–∫ —Å –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º"
        echo "  $0 status abc123      # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞"
        echo ""
        ;;

    *)
        echo "‚ùå –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ä–µ–∂–∏–º: $MODE"
        echo "   –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: $0 help"
        exit 1
        ;;
esac
